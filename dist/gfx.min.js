var gfx=function(){"use strict";const e=9728;const t=9729;const i=9984;const r=9985;const _=9986;const T=9987;const n=5121;const a=5123;const s=5126;const o=33635;const l=32819;const E=32820;const f=36193;const R=6402;const h=6406;const u=6407;const m=6408;const c=6409;const d=6410;const p=33776;const A=33777;const F=33778;const U=33779;const g=35840;const P=35841;const I=35842;const x=35843;const y=36196;const M=[[e,i,_],[t,r,T]];const X=[{format:u,internalFormat:p,pixelType:null},{format:m,internalFormat:A,pixelType:null},{format:m,internalFormat:F,pixelType:null},{format:m,internalFormat:U,pixelType:null},{format:u,internalFormat:y,pixelType:null},{format:u,internalFormat:P,pixelType:null},{format:m,internalFormat:x,pixelType:null},{format:u,internalFormat:g,pixelType:null},{format:m,internalFormat:I,pixelType:null},{format:h,internalFormat:h,pixelType:n},{format:c,internalFormat:c,pixelType:n},{format:d,internalFormat:d,pixelType:n},{format:u,internalFormat:u,pixelType:o},{format:m,internalFormat:m,pixelType:E},{format:m,internalFormat:m,pixelType:l},{format:u,internalFormat:u,pixelType:n},{format:m,internalFormat:m,pixelType:n},{format:u,internalFormat:u,pixelType:f},{format:m,internalFormat:m,pixelType:f},{format:u,internalFormat:u,pixelType:s},{format:m,internalFormat:m,pixelType:s},{format:null,internalFormat:null,pixelType:null},{format:null,internalFormat:null,pixelType:null},{format:null,internalFormat:null,pixelType:null},{format:null,internalFormat:null,pixelType:null},{format:R,internalFormat:R,pixelType:a},{format:null,internalFormat:null,pixelType:null}];let B={USAGE_STATIC:35044,USAGE_DYNAMIC:35048,USAGE_STREAM:35040,INDEX_FMT_UINT8:5121,INDEX_FMT_UINT16:5123,INDEX_FMT_UINT32:5125,ATTR_POSITION:"a_position",ATTR_NORMAL:"a_normal",ATTR_TANGENT:"a_tangent",ATTR_BITANGENT:"a_bitangent",ATTR_WEIGHT:"a_weight",ATTR_INDICES:"a_indices",ATTR_COLOR:"a_color",ATTR_COLOR0:"a_color0",ATTR_COLOR1:"a_color1",ATTR_UV:"a_uv",ATTR_UV0:"a_uv0",ATTR_UV1:"a_uv1",ATTR_UV2:"a_uv2",ATTR_UV3:"a_uv3",ATTR_UV4:"a_uv4",ATTR_UV5:"a_uv5",ATTR_UV6:"a_uv6",ATTR_UV7:"a_uv7",ATTR_TYPE_INT8:5120,ATTR_TYPE_UINT8:5121,ATTR_TYPE_INT16:5122,ATTR_TYPE_UINT16:5123,ATTR_TYPE_INT32:5124,ATTR_TYPE_UINT32:5125,ATTR_TYPE_FLOAT32:5126,FILTER_NEAREST:0,FILTER_LINEAR:1,WRAP_REPEAT:10497,WRAP_CLAMP:33071,WRAP_MIRROR:33648,TEXTURE_FMT_RGB_DXT1:0,TEXTURE_FMT_RGBA_DXT1:1,TEXTURE_FMT_RGBA_DXT3:2,TEXTURE_FMT_RGBA_DXT5:3,TEXTURE_FMT_RGB_ETC1:4,TEXTURE_FMT_RGB_PVRTC_2BPPV1:5,TEXTURE_FMT_RGBA_PVRTC_2BPPV1:6,TEXTURE_FMT_RGB_PVRTC_4BPPV1:7,TEXTURE_FMT_RGBA_PVRTC_4BPPV1:8,TEXTURE_FMT_A8:9,TEXTURE_FMT_L8:10,TEXTURE_FMT_L8_A8:11,TEXTURE_FMT_R5_G6_B5:12,TEXTURE_FMT_R5_G5_B5_A1:13,TEXTURE_FMT_R4_G4_B4_A4:14,TEXTURE_FMT_RGB8:15,TEXTURE_FMT_RGBA8:16,TEXTURE_FMT_RGB16F:17,TEXTURE_FMT_RGBA16F:18,TEXTURE_FMT_RGB32F:19,TEXTURE_FMT_RGBA32F:20,TEXTURE_FMT_R32F:21,TEXTURE_FMT_111110F:22,TEXTURE_FMT_SRGB:23,TEXTURE_FMT_SRGBA:24,TEXTURE_FMT_DEPTH:25,TEXTURE_FMT_DEPTHSTENCIL:26};function N(e){if(e===B.ATTR_TYPE_INT8){return 1}else if(e===B.ATTR_TYPE_UINT8){return 1}else if(e===B.ATTR_TYPE_INT16){return 2}else if(e===B.ATTR_TYPE_UINT16){return 2}else if(e===B.ATTR_TYPE_INT32){return 4}else if(e===B.ATTR_TYPE_UINT32){return 4}else if(e===B.ATTR_TYPE_FLOAT32){return 4}console.warn(`Unknown ATTR_TYPE: ${e}`);return 0}function S(e,t,i=-1){let r=M[t][i+1];if(r===undefined){console.warn(`Unknown FILTER: ${t}`);return i===-1?e.LINEAR:e.LINEAR_MIPMAP_LINEAR}return r}function L(e){let t=X[e];if(t===undefined){console.warn(`Unknown TEXTURE_FMT: ${e}`);return X[B.TEXTURE_FMT_RGBA8]}return t}class b{constructor(e,t,i,r,_,T){this._device=e;this._format=t;this._usage=i;this._persist=T;let n=0;if(t===B.INDEX_FMT_UINT8){n=_}else if(t===B.INDEX_FMT_UINT16){n=2*_}else if(t===B.INDEX_FMT_UINT32){n=4*_}this._bytes=n;this._id=e._gl.createBuffer();this._data=null;this.update(0,r);e._vram.ib+=n}destroy(){if(this._id===-1){console.error("The buffer already destroyed");return}let e=this.device.gl;e.deleteBuffer(this._id);this.device._vram.ib-=this.bytes;this._id=-1}update(e,t){if(this._id===-1){console.error("The buffer is destroyed");return}if(t&&t.byteLength+e>=this._bytes){console.error("Failed to update data, bytes exceed.");return}let i=this._device._gl;let r=this._usage;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._id);if(!t){i.bufferData(i.ELEMENT_ARRAY_BUFFER,this._bytes,r)}else{if(e){i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,t,r)}else{i.bufferData(i.ELEMENT_ARRAY_BUFFER,t,r)}}i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null);if(this._persist){if(this._data){this._data.set(t,e)}else{this._data=t}}}}class v{constructor(e,t,i,r,_,T){this._device=e;this._format=t;this._usage=i;this._persist=T;this._bytes=this._format._bytes*_;this._id=e._gl.createBuffer();this._data=null;this.update(0,r);e._vram.vb+=this._bytes}destroy(){if(this._id===-1){console.error("The buffer already destroyed");return}let e=this.device.gl;e.deleteBuffer(this._id);this.device._vram.vb-=this.bytes;this._id=-1}update(e,t){if(this._id===-1){console.error("The buffer is destroyed");return}if(t&&t.byteLength+e>=this._bytes){console.error("Failed to update data, bytes exceed.");return}let i=this._device._gl;let r=this._usage;i.bindBuffer(i.ARRAY_BUFFER,this._id);if(!t){i.bufferData(i.ARRAY_BUFFER,this._bytes,r)}else{if(e){i.bufferSubData(i.ARRAY_BUFFER,t,r)}else{i.bufferData(i.ARRAY_BUFFER,t,r)}}i.bindBuffer(i.ARRAY_BUFFER,null);if(this._persist){if(this._data){this._data.set(t,e)}else{this._data=t}}}}class G{constructor(e,t){this._device=e;this._attributes=[];this._uniforms=[];this._samplers=[];this._linked=false;this._vertSource=t.vert;this._fragSource=t.frag;this._program=null}link(){if(this._linked){return}let e=this._device._gl;let t=D(e,e.VERTEX_SHADER,this._vertSource);let i=D(e,e.FRAGMENT_SHADER,this._fragSource);let r=e.createProgram();e.attachShader(r,t);e.attachShader(r,i);e.linkProgram(r);let _=false;if(!e.getShaderParameter(t,e.COMPILE_STATUS)){console.error(`Failed to compile vertex shader: ${e.getShaderInfoLog(t)}`);_=true}if(!e.getShaderParameter(i,e.COMPILE_STATUS)){console.error(`Failed to compile fragment shader: ${e.getShaderInfoLog(i)}`);_=true}if(!e.getProgramParameter(r,e.LINK_STATUS)){console.error(`Failed to link shader program: ${e.getProgramInfoLog(r)}`);_=true}e.deleteShader(t);e.deleteShader(i);if(_){return}this._program=r;let T=e.getProgramParameter(r,e.ACTIVE_ATTRIBUTES);for(let t=0;t<T;++t){let i=e.getActiveAttrib(r,t);let _=e.getAttribLocation(r,i.name);this._attributes.push({name:i.name,location:_,type:i.type})}let n=e.getProgramParameter(r,e.ACTIVE_UNIFORMS);for(let t=0;t<n;++t){let i=e.getActiveUniform(r,t);let _=e.getUniformLocation(r,i.name);if(i.type===e.SAMPLER_2D||i.type===e.SAMPLER_CUBE){this._samplers.push({name:i.name,location:_,type:i.type})}else{this._uniforms.push({name:i.name,location:_,type:i.type,localId:-1})}}this._linked=true}destroy(){let e=this._device._gl;e.deleteProgram(this._program);this._linked=false;this._program=null;this._attributes=[];this._uniforms=[];this._samplers=[]}}function D(e,t,i){let r=e.createShader(t);e.shaderSource(r,i);e.compileShader(r);return r}class Y{constructor(e){this._device=e;this._width=4;this._height=4;this._hasMipmap=false;this._anisotropy=1;this._minFilter=B.FILTER_LINEAR;this._magFilter=B.FILTER_LINEAR;this._mipFilter=B.FILTER_LINEAR;this._wrapS=B.WRAP_REPEAT;this._wrapT=B.WRAP_REPEAT;this._format=B.TEXTURE_FMT_RGBA8}destroy(){if(this._id===-1){console.error("The texture already destroyed");return}let e=this.device.gl;e.deleteTexture(this._id);this.device._vram.tex-=this.bytes;this._id=-1}}class C extends Y{constructor(e,t){super(e);this.update(t)}update(e){let t=this._device._gl;let i=this._hasMipmap;if(e){if(e.width!==undefined){this._width=e.width}if(e.height!==undefined){this._height=e.height}if(e.anisotropy!==undefined){this._anisotropy=e.anisotropy}if(e.minFilter!==undefined){this._minFilter=e.minFilter}if(e.magFilter!==undefined){this._magFilter=e.magFilter}if(e.mipFilter!==undefined){this._mipFilter=e.mipFilter}if(e.wrapS!==undefined){this._wrapS=e.wrapS}if(e.wrapT!==undefined){this._wrapT=e.wrapT}if(e.format!==undefined){this._format=e.format}if(e.mipmap!==undefined){this._hasMipmap=e.mipmap;i=e.mipmap}if(e.images!==undefined){if(e.images.length>1){i=false}}}t.activeTexture(t.TEXTURE0);t.bindTexture(t.TEXTURE_2D,this._id);if(e.images!==undefined){this._setMipmap(e.images)}this._setTexInfo();if(i){t.hint(t.GENERATE_MIPMAP_HINT,t.NICEST);t.generateMipmap(t.TEXTURE_2D)}t.bindTexture(t.TEXTURE_2D,null)}_setMipmap(e){let t=this._device._gl;for(let i=0;i<e.length;++i){let r=e[i];t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,false);t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false)}}_setTexInfo(){let e=this._device._gl;e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,S(e,this._minFilter,this._hasMipmap?this._mipFilter:-1));e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,S(e,this._magFilter,-1));e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,this._wrapS);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,this._wrapT);if(this._device.ext("EXT_texture_filter_anisotropic")){e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY_EXT,this._anisotropic)}}}class O{constructor(e,t){let i;try{i=e.getContext("webgl",t)}catch(e){console.error(e);return}this._gl=i;this._extensions={};this._vram={texture:0,vb:0,ib:0};this._initExtensions(["OES_vertex_array_object","OES_texture_float","OES_texture_half_float","OES_texture_half_float_linear","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_atc","EXT_texture_filter_anisotropic"])}_initExtensions(e){let t=this._gl;for(let i=0;i<e.length;++i){let r=e[i];try{let e=t.getExtension(r);if(e){this._extensions[r]=e}}catch(e){console.error(e)}}}ext(e){return this._extensions[e]}draw(e,t){}}let V={IndexBuffer:b,VertexBuffer:v,Shader:G,Texture:Y,Texture2D:C,Device:O,attrTypeBytes:N,glFilter:S,glTextureFmt:L};Object.assign(V,B);return V}();
//# sourceMappingURL=./dist/gfx.min.js.map