var gfx=function(){"use strict";let e={USAGE_STATIC:35044,USAGE_DYNAMIC:35048,USAGE_STREAM:35040,INDEX_FMT_UINT8:5121,INDEX_FMT_UINT16:5123,INDEX_FMT_UINT32:5125,ATTR_POSITION:"a_position",ATTR_NORMAL:"a_normal",ATTR_TANGENT:"a_tangent",ATTR_BITANGENT:"a_bitangent",ATTR_WEIGHT:"a_weight",ATTR_INDICES:"a_indices",ATTR_COLOR:"a_color",ATTR_COLOR0:"a_color0",ATTR_COLOR1:"a_color1",ATTR_UV:"a_uv",ATTR_UV0:"a_uv0",ATTR_UV1:"a_uv1",ATTR_UV2:"a_uv2",ATTR_UV3:"a_uv3",ATTR_UV4:"a_uv4",ATTR_UV5:"a_uv5",ATTR_UV6:"a_uv6",ATTR_UV7:"a_uv7",ATTR_TYPE_INT8:5120,ATTR_TYPE_UINT8:5121,ATTR_TYPE_INT16:5122,ATTR_TYPE_UINT16:5123,ATTR_TYPE_INT32:5124,ATTR_TYPE_UINT32:5125,ATTR_TYPE_FLOAT32:5126,FILTER_NEAREST:9728,FILTER_LINEAR:9729,FILTER_NEAREST_MIPMAP_NEAREST:9984,FILTER_LINEAR_MIPMAP_NEAREST:9985,FILTER_NEAREST_MIPMAP_LINEAR:9986,FILTER_LINEAR_MIPMAP_LINEAR:9987,WRAP_REPEAT:10497,WRAP_CLAMP:33071,WRAP_MIRROR:33648,TEXTURE_FMT_DXT1:0,TEXTURE_FMT_DXT3:1,TEXTURE_FMT_DXT5:2,TEXTURE_FMT_ETC1:3,TEXTURE_FMT_PVRTC_2BPP_RGB_1:4,TEXTURE_FMT_PVRTC_2BPP_RGBA_1:5,TEXTURE_FMT_PVRTC_4BPP_RGB_1:6,TEXTURE_FMT_PVRTC_4BPP_RGBA_1:7,TEXTURE_FMT_A8:8,TEXTURE_FMT_L8:9,TEXTURE_FMT_L8_A8:10,TEXTURE_FMT_R5_G6_B5:11,TEXTURE_FMT_R5_G5_B5_A1:12,TEXTURE_FMT_R4_G4_B4_A4:13,TEXTURE_FMT_RGB8:14,TEXTURE_FMT_RGBA8:15,TEXTURE_FMT_RGB16F:16,TEXTURE_FMT_RGBA16F:17,TEXTURE_FMT_RGB32F:18,TEXTURE_FMT_RGBA32F:19,TEXTURE_FMT_R32F:20,TEXTURE_FMT_111110F:21,TEXTURE_FMT_SRGB:22,TEXTURE_FMT_SRGBA:23,TEXTURE_FMT_DEPTH:24,TEXTURE_FMT_DEPTHSTENCIL:25};function t(t){if(t===e.ATTR_TYPE_INT8){return 1}else if(t===e.ATTR_TYPE_UINT8){return 1}else if(t===e.ATTR_TYPE_INT16){return 2}else if(t===e.ATTR_TYPE_UINT16){return 2}else if(t===e.ATTR_TYPE_INT32){return 4}else if(t===e.ATTR_TYPE_UINT32){return 4}else if(t===e.ATTR_TYPE_FLOAT32){return 4}console.warn(`Unknown ATTR_TYPE: ${t}`);return 0}class _{constructor(t,_,i,T,r,s){this._device=t;this._format=_;this._usage=i;this._persist=s;let a=0;if(_===e.INDEX_FMT_UINT8){a=r}else if(_===e.INDEX_FMT_UINT16){a=2*r}else if(_===e.INDEX_FMT_UINT32){a=4*r}this._bytes=a;this._id=t._gl.createBuffer();this._data=null;this.update(0,T);t._vram.ib+=a}destroy(){if(this._id===-1){console.error("The buffer already destroyed");return}let e=this.device.gl;e.deleteBuffer(this._id);this.device._vram.ib-=this.bytes;this._id=-1}update(e,t){if(this._id===-1){console.error("The buffer is destroyed");return}if(t&&t.byteLength+e>=this._bytes){console.error("Failed to update data, bytes exceed.");return}let _=this._device._gl;let i=this._usage;_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,this._id);if(!t){_.bufferData(_.ELEMENT_ARRAY_BUFFER,this._bytes,i)}else{if(e){_.bufferSubData(_.ELEMENT_ARRAY_BUFFER,t,i)}else{_.bufferData(_.ELEMENT_ARRAY_BUFFER,t,i)}}_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,null);if(this._persist){if(this._data){this._data.set(t,e)}else{this._data=t}}}}class i{constructor(e,t,_,i,T,r){this._device=e;this._format=t;this._usage=_;this._persist=r;this._bytes=this._format._bytes*T;this._id=e._gl.createBuffer();this._data=null;this.update(0,i);e._vram.vb+=this._bytes}destroy(){if(this._id===-1){console.error("The buffer already destroyed");return}let e=this.device.gl;e.deleteBuffer(this._id);this.device._vram.vb-=this.bytes;this._id=-1}update(e,t){if(this._id===-1){console.error("The buffer is destroyed");return}if(t&&t.byteLength+e>=this._bytes){console.error("Failed to update data, bytes exceed.");return}let _=this._device._gl;let i=this._usage;_.bindBuffer(_.ARRAY_BUFFER,this._id);if(!t){_.bufferData(_.ARRAY_BUFFER,this._bytes,i)}else{if(e){_.bufferSubData(_.ARRAY_BUFFER,t,i)}else{_.bufferData(_.ARRAY_BUFFER,t,i)}}_.bindBuffer(_.ARRAY_BUFFER,null);if(this._persist){if(this._data){this._data.set(t,e)}else{this._data=t}}}}class T{constructor(e,t){this._device=e;this._attributes=[];this._uniforms=[];this._samplers=[];this._linked=false;this._vertSource=t.vert;this._fragSource=t.frag;this._program=null}link(){if(this._linked){return}let e=this._device._gl;let t=r(e,e.VERTEX_SHADER,this._vertSource);let _=r(e,e.FRAGMENT_SHADER,this._fragSource);let i=e.createProgram();e.attachShader(i,t);e.attachShader(i,_);e.linkProgram(i);let T=false;if(!e.getShaderParameter(t,e.COMPILE_STATUS)){console.error(`Failed to compile vertex shader: ${e.getShaderInfoLog(t)}`);T=true}if(!e.getShaderParameter(_,e.COMPILE_STATUS)){console.error(`Failed to compile fragment shader: ${e.getShaderInfoLog(_)}`);T=true}if(!e.getProgramParameter(i,e.LINK_STATUS)){console.error(`Failed to link shader program: ${e.getProgramInfoLog(i)}`);T=true}e.deleteShader(t);e.deleteShader(_);if(T){return}this._program=i;let s=e.getProgramParameter(i,e.ACTIVE_ATTRIBUTES);for(let t=0;t<s;++t){let _=e.getActiveAttrib(i,t);let T=e.getAttribLocation(i,_.name);this._attributes.push({name:_.name,location:T,type:_.type})}let a=e.getProgramParameter(i,e.ACTIVE_UNIFORMS);for(let t=0;t<a;++t){let _=e.getActiveUniform(i,t);let T=e.getUniformLocation(i,_.name);if(_.type===e.SAMPLER_2D||_.type===e.SAMPLER_CUBE){this._samplers.push({name:_.name,location:T,type:_.type})}else{this._uniforms.push({name:_.name,location:T,type:_.type,localId:-1})}}this._linked=true}destroy(){let e=this._device._gl;e.deleteProgram(this._program);this._linked=false;this._program=null;this._attributes=[];this._uniforms=[];this._samplers=[]}}function r(e,t,_){let i=e.createShader(t);e.shaderSource(i,_);e.compileShader(i);return i}class s{constructor(t){this._device=t;this._width=4;this._height=4;this._mipmaps=true;this._anisotropy=1;this._minFilter=e.FILTER_LINEAR_MIPMAP_LINEAR;this._magFilter=e.FILTER_LINEAR;this._wrapS=e.WRAP_REPEAT;this._wrapT=e.WRAP_REPEAT;this._format=e.TEXTURE_FMT_RGBA8}destroy(){if(this._id===-1){console.error("The texture already destroyed");return}let e=this.device.gl;e.deleteTexture(this._id);this.device._vram.tex-=this.bytes;this._id=-1}}class a extends s{constructor(e,t){super(e);this.update(t)}update(e){let t=this._device._gl;if(e){if(e.width!==undefined){this._width=e.width}if(e.height!==undefined){this._height=e.height}if(e.mipmpas!==undefined){this._mipmaps=e.mipmpas}if(e.anisotropy!==undefined){this._anisotropy=e.anisotropy}if(e.minFilter!==undefined){this._minFilter=e.minFilter}if(e.magFilter!==undefined){this._magFilter=e.magFilter}if(e.wrapS!==undefined){this._wrapS=e.wrapS}if(e.wrapT!==undefined){this._wrapT=e.wrapT}if(e.format!==undefined){this._format=e.format}}t.activeTexture(t.TEXTURE0);t.bindTexture(t.TEXTURE_2D,this._id);this._setTexInfo();t.bindTexture(t.TEXTURE_2D,null)}_setTexInfo(){let e=this._device._gl;e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this._minFilter);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,this._magFilter);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,this._wrapS);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,this._wrapT);if(this._device.hasExt("EXT_texture_filter_anisotropic")){e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY_EXT,this._anisotropic)}if(this._mipmaps){e.hint(e.GENERATE_MIPMAP_HINT,e.NICEST);e.generateMipmap(e.TEXTURE_2D)}}}class E{constructor(e,t){let _;try{_=e.getContext("webgl",t)}catch(e){console.error(e);return}this._gl=_;this._extensions={};this._vram={texture:0,vb:0,ib:0};this._initExtensions(["OES_vertex_array_object","OES_texture_float","OES_texture_half_float","OES_texture_half_float_linear","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_atc","EXT_texture_filter_anisotropic"])}_initExtensions(e){let t=this._gl;for(let _=0;_<e.length;++_){let i=e[_];try{let e=t.getExtension(i);if(e){this._extensions[i]=e}}catch(e){console.error(e)}}}hasExt(e){return this._extensions[e]!==undefined}draw(e,t){}}let n={IndexBuffer:_,VertexBuffer:i,Shader:T,Texture:s,Texture2D:a,Device:E,attrTypeBytes:t};Object.assign(n,e);return n}();
//# sourceMappingURL=./dist/gfx.min.js.map