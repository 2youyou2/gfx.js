var gfx=function(){"use strict";var e=9728;var t=9729;var i=9984;var n=9985;var r=9986;var s=9987;var a=5121;var l=5123;var _=5125;var o=5126;var f=33635;var c=32819;var u=32820;var p=36193;var T=6402;var h=6406;var E=6407;var d=6408;var F=6409;var m=6410;var R=33776;var v=33777;var A=33778;var x=33779;var S=35840;var B=35841;var P=35842;var b=35843;var U=36196;var g=[[e,i,r],[t,n,s]];var L=[{format:E,internalFormat:R,pixelType:null},{format:d,internalFormat:v,pixelType:null},{format:d,internalFormat:A,pixelType:null},{format:d,internalFormat:x,pixelType:null},{format:E,internalFormat:U,pixelType:null},{format:E,internalFormat:B,pixelType:null},{format:d,internalFormat:b,pixelType:null},{format:E,internalFormat:S,pixelType:null},{format:d,internalFormat:P,pixelType:null},{format:h,internalFormat:h,pixelType:a},{format:F,internalFormat:F,pixelType:a},{format:m,internalFormat:m,pixelType:a},{format:E,internalFormat:E,pixelType:f},{format:d,internalFormat:d,pixelType:u},{format:d,internalFormat:d,pixelType:c},{format:E,internalFormat:E,pixelType:a},{format:d,internalFormat:d,pixelType:a},{format:E,internalFormat:E,pixelType:p},{format:d,internalFormat:d,pixelType:p},{format:E,internalFormat:E,pixelType:o},{format:d,internalFormat:d,pixelType:o},{format:null,internalFormat:null,pixelType:null},{format:null,internalFormat:null,pixelType:null},{format:null,internalFormat:null,pixelType:null},{format:null,internalFormat:null,pixelType:null},{format:T,internalFormat:T,pixelType:l},{format:T,internalFormat:T,pixelType:_},{format:null,internalFormat:null,pixelType:null}];var I={USAGE_STATIC:35044,USAGE_DYNAMIC:35048,USAGE_STREAM:35040,INDEX_FMT_UINT8:5121,INDEX_FMT_UINT16:5123,INDEX_FMT_UINT32:5125,ATTR_POSITION:"a_position",ATTR_NORMAL:"a_normal",ATTR_TANGENT:"a_tangent",ATTR_BITANGENT:"a_bitangent",ATTR_WEIGHT:"a_weight",ATTR_INDICES:"a_indices",ATTR_COLOR:"a_color",ATTR_COLOR0:"a_color0",ATTR_COLOR1:"a_color1",ATTR_UV:"a_uv",ATTR_UV0:"a_uv0",ATTR_UV1:"a_uv1",ATTR_UV2:"a_uv2",ATTR_UV3:"a_uv3",ATTR_UV4:"a_uv4",ATTR_UV5:"a_uv5",ATTR_UV6:"a_uv6",ATTR_UV7:"a_uv7",ATTR_TYPE_INT8:5120,ATTR_TYPE_UINT8:5121,ATTR_TYPE_INT16:5122,ATTR_TYPE_UINT16:5123,ATTR_TYPE_INT32:5124,ATTR_TYPE_UINT32:5125,ATTR_TYPE_FLOAT32:5126,FILTER_NEAREST:0,FILTER_LINEAR:1,WRAP_REPEAT:10497,WRAP_CLAMP:33071,WRAP_MIRROR:33648,TEXTURE_FMT_RGB_DXT1:0,TEXTURE_FMT_RGBA_DXT1:1,TEXTURE_FMT_RGBA_DXT3:2,TEXTURE_FMT_RGBA_DXT5:3,TEXTURE_FMT_RGB_ETC1:4,TEXTURE_FMT_RGB_PVRTC_2BPPV1:5,TEXTURE_FMT_RGBA_PVRTC_2BPPV1:6,TEXTURE_FMT_RGB_PVRTC_4BPPV1:7,TEXTURE_FMT_RGBA_PVRTC_4BPPV1:8,TEXTURE_FMT_A8:9,TEXTURE_FMT_L8:10,TEXTURE_FMT_L8_A8:11,TEXTURE_FMT_R5_G6_B5:12,TEXTURE_FMT_R5_G5_B5_A1:13,TEXTURE_FMT_R4_G4_B4_A4:14,TEXTURE_FMT_RGB8:15,TEXTURE_FMT_RGBA8:16,TEXTURE_FMT_RGB16F:17,TEXTURE_FMT_RGBA16F:18,TEXTURE_FMT_RGB32F:19,TEXTURE_FMT_RGBA32F:20,TEXTURE_FMT_R32F:21,TEXTURE_FMT_111110F:22,TEXTURE_FMT_SRGB:23,TEXTURE_FMT_SRGBA:24,TEXTURE_FMT_D16:25,TEXTURE_FMT_D32:26,TEXTURE_FMT_D24S8:27,DS_FUNC_NEVER:512,DS_FUNC_LESS:513,DS_FUNC_EQUAL:514,DS_FUNC_LEQUAL:515,DS_FUNC_GREATER:516,DS_FUNC_NOTEQUAL:517,DS_FUNC_GEQUAL:518,DS_FUNC_ALWAYS:519,RB_FMT_RGBA4:32854,RB_FMT_RGB5_A1:32855,RB_FMT_RGB565:36194,RB_FMT_D16:33189,RB_FMT_S8:36168,RB_FMT_D24S8:34041,BLEND_FUNC_ADD:32774,BLEND_FUNC_SUBTRACT:32778,BLEND_FUNC_REVERSE_SUBTRACT:32779,BLEND_ZERO:0,BLEND_ONE:1,BLEND_SRC_COLOR:768,BLEND_ONE_MINUS_SRC_COLOR:769,BLEND_DST_COLOR:774,BLEND_ONE_MINUS_DST_COLOR:775,BLEND_SRC_ALPHA:770,BLEND_ONE_MINUS_SRC_ALPHA:771,BLEND_DST_ALPHA:772,BLEND_ONE_MINUS_DST_ALPHA:773,BLEND_CONSTANT_COLOR:32769,BLEND_ONE_MINUS_CONSTANT_COLOR:32770,BLEND_CONSTANT_ALPHA:32771,BLEND_ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_SRC_ALPHA_SATURATE:776,STENCIL_OP_KEEP:7680,STENCIL_OP_ZERO:0,STENCIL_OP_REPLACE:7681,STENCIL_OP_INCR:7682,STENCIL_OP_INCR_WRAP:34055,STENCIL_OP_DECR:7683,STENCIL_OP_DECR_WRAP:34056,STENCIL_OP_INVERT:5386,CULL_NONE:0,CULL_FRONT:1028,CULL_BACK:1029,CULL_FRONT_AND_BACK:1032,PT_POINTS:0,PT_LINES:1,PT_LINE_LOOP:2,PT_LINE_STRIP:3,PT_TRIANGLES:4,PT_TRIANGLE_STRIP:5,PT_TRIANGLE_FAN:6};function M(e){if(e===I.ATTR_TYPE_INT8){return 1}else if(e===I.ATTR_TYPE_UINT8){return 1}else if(e===I.ATTR_TYPE_INT16){return 2}else if(e===I.ATTR_TYPE_UINT16){return 2}else if(e===I.ATTR_TYPE_INT32){return 4}else if(e===I.ATTR_TYPE_UINT32){return 4}else if(e===I.ATTR_TYPE_FLOAT32){return 4}console.warn("Unknown ATTR_TYPE: "+e);return 0}function N(e,t,i){if(i===void 0)i=-1;var n=g[t][i+1];if(n===undefined){console.warn("Unknown FILTER: "+t);return i===-1?e.LINEAR:e.LINEAR_MIPMAP_LINEAR}return n}function O(e){var t=L[e];if(t===undefined){console.warn("Unknown TEXTURE_FMT: "+e);return L[I.TEXTURE_FMT_RGBA8]}return t}var D=function e(t){var i=this;this._attr2el={};this._elements=[];this._bytes=0;var n=0;for(var r=0,s=t.length;r<s;++r){var a=t[r];var l={name:a.name,offset:n,stride:0,stream:-1,type:a.type,num:a.num,normalize:a.normalize===undefined?false:a.normalize,bytes:a.num*M(a.type)};i._attr2el[l.name]=l;i._elements.push(l);i._bytes+=l.bytes;n+=l.bytes}for(var _=0,o=this._elements.length;_<o;++_){var f=i._elements[_];f.stride=i._bytes}};D.prototype.element=function e(t){return this._attr2el[t]};var y=function e(t,i,n,r,s,a){this._device=t;this._format=i;this._usage=n;this._persist=a;this._numIndices=s;var l=0;if(i===I.INDEX_FMT_UINT8){l=s}else if(i===I.INDEX_FMT_UINT16){l=2*s}else if(i===I.INDEX_FMT_UINT32){l=4*s}this._bytes=l;this._glID=t._gl.createBuffer();this._data=null;this.update(0,r);t._stats.ib+=l};var C={count:{}};y.prototype.destroy=function e(){if(this._glID===-1){console.error("The buffer already destroyed");return}var t=this.device.gl;t.deleteBuffer(this._glID);this.device._stats.ib-=this.bytes;this._glID=-1};y.prototype.update=function e(t,i){if(this._glID===-1){console.error("The buffer is destroyed");return}if(i&&i.byteLength+t>this._bytes){console.error("Failed to update data, bytes exceed.");return}var n=this._device._gl;var r=this._usage;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this._glID);if(!i){n.bufferData(n.ELEMENT_ARRAY_BUFFER,this._bytes,r)}else{if(t){n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,i,r)}else{n.bufferData(n.ELEMENT_ARRAY_BUFFER,i,r)}}n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null);if(this._persist){if(this._data){this._data.set(i,t)}else{this._data=i}}};C.count.get=function(){return this._numIndices};Object.defineProperties(y.prototype,C);var k=function e(t,i,n,r,s,a){this._device=t;this._format=i;this._usage=n;this._persist=a;this._numVertices=s;this._bytes=this._format._bytes*s;this._glID=t._gl.createBuffer();this._data=null;this.update(0,r);t._stats.vb+=this._bytes};var X={count:{}};k.prototype.destroy=function e(){if(this._glID===-1){console.error("The buffer already destroyed");return}var t=this.device.gl;t.deleteBuffer(this._glID);this.device._stats.vb-=this.bytes;this._glID=-1};k.prototype.update=function e(t,i){if(this._glID===-1){console.error("The buffer is destroyed");return}if(i&&i.byteLength+t>this._bytes){console.error("Failed to update data, bytes exceed.");return}var n=this._device._gl;var r=this._usage;n.bindBuffer(n.ARRAY_BUFFER,this._glID);if(!i){n.bufferData(n.ARRAY_BUFFER,this._bytes,r)}else{if(t){n.bufferSubData(n.ARRAY_BUFFER,i,r)}else{n.bufferData(n.ARRAY_BUFFER,i,r)}}n.bindBuffer(n.ARRAY_BUFFER,null);if(this._persist){if(this._data){this._data.set(i,t)}else{this._data=i}}};X.count.get=function(){return this._numVertices};Object.defineProperties(k.prototype,X);var W=0;function w(e,t,i){i.split("\n").forEach(function(i){if(i.length<5){return}var n=/^ERROR\:\s+(\d+)\:(\d+)\:\s*(.*)$/.exec(i);if(n){e.push({type:t,fileID:n[1]|0,line:n[2]|0,message:n[3].trim()})}else if(i.length>0){e.push({type:t,fileID:-1,line:0,message:i})}})}var G=function e(t,i){this._device=t;this._attributes=[];this._uniforms=[];this._samplers=[];this._errors=[];this._linked=false;this._vertSource=i.vert;this._fragSource=i.frag;this._glID=null;this._id=W++};var Y={id:{}};Y.id.get=function(){return this._id};G.prototype.link=function e(){var t=this;if(this._linked){return}var i=this._device._gl;var n=Z(i,i.VERTEX_SHADER,this._vertSource);var r=Z(i,i.FRAGMENT_SHADER,this._fragSource);var s=i.createProgram();i.attachShader(s,n);i.attachShader(s,r);i.linkProgram(s);var a=false;var l=this._errors;if(!i.getShaderParameter(n,i.COMPILE_STATUS)){w(l,"vs",i.getShaderInfoLog(n));a=true}if(!i.getShaderParameter(r,i.COMPILE_STATUS)){w(l,"fs",i.getShaderInfoLog(r));a=true}i.deleteShader(n);i.deleteShader(r);if(a){l.forEach(function(e){console.error("Failed to compile "+e.type+" "+e.fileID+" (ln "+e.line+"): "+e.message)});return}if(!i.getProgramParameter(s,i.LINK_STATUS)){console.error("Failed to link shader program: "+i.getProgramInfoLog(s));a=true}if(a){return}this._glID=s;var _=i.getProgramParameter(s,i.ACTIVE_ATTRIBUTES);for(var o=0;o<_;++o){var f=i.getActiveAttrib(s,o);var c=i.getAttribLocation(s,f.name);t._attributes.push({name:f.name,location:c,type:f.type})}var u=i.getProgramParameter(s,i.ACTIVE_UNIFORMS);for(var p=0;p<u;++p){var T=i.getActiveUniform(s,p);var h=T.name;var E=i.getUniformLocation(s,h);var d=h.substr(h.length-3)==="[0]";if(d){h=h.substr(0,h.length-3)}t._uniforms.push({name:h,location:E,type:T.type,size:d?T.size:undefined})}this._linked=true};G.prototype.destroy=function e(){var t=this._device._gl;t.deleteProgram(this._glID);this._linked=false;this._glID=null;this._attributes=[];this._uniforms=[];this._samplers=[]};Object.defineProperties(G.prototype,Y);function Z(e,t,i){var n=e.createShader(t);e.shaderSource(n,i);e.compileShader(n);return n}var H=function e(t){this._device=t;this._width=4;this._height=4;this._hasMipmap=false;this._compressed=false;this._anisotropy=1;this._minFilter=I.FILTER_LINEAR;this._magFilter=I.FILTER_LINEAR;this._mipFilter=I.FILTER_LINEAR;this._wrapS=I.WRAP_REPEAT;this._wrapT=I.WRAP_REPEAT;this._format=I.TEXTURE_FMT_RGBA8;this._target=-1};H.prototype.destroy=function e(){if(this._glID===-1){console.error("The texture already destroyed");return}var t=this.device.gl;t.deleteTexture(this._glID);this.device._stats.tex-=this.bytes;this._glID=-1};function V(e){return!(e&e-1)&&!!e}var K=function(e){function t(t,i){e.call(this,t);this._target=this._device._gl.TEXTURE_2D;this.update(i)}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.update=function e(t){var i=this._device._gl;var n=this._hasMipmap;if(t){if(t.width!==undefined){this._width=t.width}if(t.height!==undefined){this._height=t.height}if(t.anisotropy!==undefined){this._anisotropy=t.anisotropy}if(t.minFilter!==undefined){this._minFilter=t.minFilter}if(t.magFilter!==undefined){this._magFilter=t.magFilter}if(t.mipFilter!==undefined){this._mipFilter=t.mipFilter}if(t.wrapS!==undefined){this._wrapS=t.wrapS}if(t.wrapT!==undefined){this._wrapT=t.wrapT}if(t.format!==undefined){this._format=t.format;this._compressed=this._format>=I.TEXTURE_FMT_RGB_DXT1&&this._format<=I.TEXTURE_FMT_RGBA_PVRTC_4BPPV1}if(t.mipmap!==undefined){this._hasMipmap=t.mipmap;n=t.mipmap}if(t.images!==undefined){if(t.images.length>1){n=false}}}this._glID=i.createTexture();i.activeTexture(i.TEXTURE0);i.bindTexture(i.TEXTURE_2D,this._glID);var r=t.images||[null];this._setMipmap(r,t.flipY,t.premultiplyAlpha);this._setTexInfo();if(n){i.hint(i.GENERATE_MIPMAP_HINT,i.NICEST);i.generateMipmap(i.TEXTURE_2D)}this._device._restoreTexture(0)};t.prototype.updateSubImage=function e(t){var i=this._device._gl;var n=O(this._format);i.activeTexture(i.TEXTURE0);i.bindTexture(i.TEXTURE_2D,this._glID);this._setSubImage(n,t);this._device._restoreTexture(0)};t.prototype.updateImage=function e(t){var i=this._device._gl;var n=O(this._format);i.activeTexture(i.TEXTURE0);i.bindTexture(i.TEXTURE_2D,this._glID);this._setImage(n,t);this._device._restoreTexture(0)};t.prototype._setSubImage=function e(t,i){var n=this._device._gl;var r=i.flipY;var s=i.premultiplyAlpha;var a=i.image;if(a instanceof HTMLCanvasElement||a instanceof HTMLImageElement||a instanceof HTMLVideoElement){if(r===undefined){n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,true)}else{n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,r)}if(s===undefined){n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false)}else{n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s)}n.texSubImage2D(n.TEXTURE_2D,i.level,i.x,i.y,t.format,t.pixelType,a)}else{if(r===undefined){n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,false)}else{n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,r)}if(s===undefined){n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false)}else{n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s)}if(this._compressed){n.compressedTexSubImage2D(n.TEXTURE_2D,i.level,i.x,i.y,i.width,i.height,t.format,a)}else{n.texSubImage2D(n.TEXTURE_2D,i.level,i.x,i.y,i.width,i.height,t.format,t.pixelType,a)}}};t.prototype._setImage=function e(t,i){var n=this._device._gl;var r=i.flipY;var s=i.premultiplyAlpha;var a=i.image;if(a instanceof HTMLCanvasElement||a instanceof HTMLImageElement||a instanceof HTMLVideoElement){if(r===undefined){n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,true)}else{n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,r)}if(s===undefined){n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false)}else{n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s)}n.texImage2D(n.TEXTURE_2D,i.level,t.internalFormat,t.format,t.pixelType,a)}else{if(r===undefined){n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,false)}else{n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,r)}if(s===undefined){n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false)}else{n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s)}if(this._compressed){n.compressedTexImage2D(n.TEXTURE_2D,i.level,t.internalFormat,i.width,i.height,0,a)}else{n.texImage2D(n.TEXTURE_2D,i.level,t.internalFormat,i.width,i.height,0,t.format,t.pixelType,a)}}};t.prototype._setMipmap=function e(t,i,n){var r=this;var s=O(this._format);var a={width:this._width,height:this._height,flipY:i,premultiplyAlpha:n,level:0,image:null};for(var l=0;l<t.length;++l){a.level=l;a.width=r._width>>l;a.height=r._height>>l;a.image=t[l];r._setImage(s,a)}};t.prototype._setTexInfo=function e(){var t=this._device._gl;var i=V(this._width)&&V(this._height);if(!i&&(this._wrapS!==I.WRAP_CLAMP||this._wrapT!==I.WRAP_CLAMP)){console.warn("WebGL1 doesn't support all wrap modes with NPOT textures");this._wrapS=I.WRAP_CLAMP;this._wrapT=I.WRAP_CLAMP}t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,N(t,this._minFilter,this._hasMipmap?this._mipFilter:-1));t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,N(t,this._magFilter,-1));t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this._wrapS);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this._wrapT);var n=this._device.ext("EXT_texture_filter_anisotropic");if(n){t.texParameteri(t.TEXTURE_2D,n.TEXTURE_MAX_ANISOTROPY_EXT,this._anisotropy)}};return t}(H);var q=function(e){function t(t,i){e.call(this,t);this._target=this._device._gl.TEXTURE_CUBE_MAP;this.update(i)}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.update=function e(t){var i=this._device._gl;var n=this._hasMipmap;if(t){if(t.width!==undefined){this._width=t.width}if(t.height!==undefined){this._height=t.height}if(t.anisotropy!==undefined){this._anisotropy=t.anisotropy}if(t.minFilter!==undefined){this._minFilter=t.minFilter}if(t.magFilter!==undefined){this._magFilter=t.magFilter}if(t.mipFilter!==undefined){this._mipFilter=t.mipFilter}if(t.wrapS!==undefined){this._wrapS=t.wrapS}if(t.wrapT!==undefined){this._wrapT=t.wrapT}if(t.format!==undefined){this._format=t.format;this._compressed=this._format>=I.TEXTURE_FMT_RGB_DXT1&&this._format<=I.TEXTURE_FMT_RGBA_PVRTC_4BPPV1}if(t.mipmap!==undefined){this._hasMipmap=t.mipmap;n=t.mipmap}if(t.images!==undefined){if(t.images.length>1){n=false}}}this._glID=i.createTexture();i.activeTexture(i.TEXTURE0);i.bindTexture(i.TEXTURE_CUBE_MAP,this._glID);if(t.images!==undefined){this._setMipmap(t.images,t.flipY,t.premultiplyAlpha)}this._setTexInfo();if(n){i.hint(i.GENERATE_MIPMAP_HINT,i.NICEST);i.generateMipmap(i.TEXTURE_CUBE_MAP)}this._device._restoreTexture(0)};t.prototype.updateSubImage=function e(t){var i=this._device._gl;var n=O(this._format);i.activeTexture(i.TEXTURE0);i.bindTexture(i.TEXTURE_CUBE_MAP,this._glID);this._setSubImage(n,t);this._device._restoreTexture(0)};t.prototype.updateImage=function e(t){var i=this._device._gl;var n=O(this._format);i.activeTexture(i.TEXTURE0);i.bindTexture(i.TEXTURE_CUBE_MAP,this._glID);this._setImage(n,t);this._device._restoreTexture(0)};t.prototype._setSubImage=function e(t,i){var n=this._device._gl;var r=i.flipY;var s=i.premultiplyAlpha;var a=i.faceIndex;var l=i.image;if(r===undefined){n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,false)}else{n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,r)}if(s===undefined){n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false)}else{n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s)}if(l instanceof HTMLCanvasElement||l instanceof HTMLImageElement||l instanceof HTMLVideoElement){n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+a,i.level,i.x,i.y,t.format,t.pixelType,l)}else{if(this._compressed){n.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+a,i.level,i.x,i.y,i.width,i.height,t.format,l)}else{n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+a,i.level,i.x,i.y,i.width,i.height,t.format,t.pixelType,l)}}};t.prototype._setImage=function e(t,i){var n=this._device._gl;var r=i.flipY;var s=i.premultiplyAlpha;var a=i.faceIndex;var l=i.image;if(r===undefined){n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,false)}else{n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,r)}if(s===undefined){n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false)}else{n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s)}if(l instanceof HTMLCanvasElement||l instanceof HTMLImageElement||l instanceof HTMLVideoElement){n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+a,i.level,t.internalFormat,t.format,t.pixelType,l)}else{if(this._compressed){n.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+a,i.level,t.internalFormat,i.width,i.height,0,l)}else{n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+a,i.level,t.internalFormat,i.width,i.height,0,t.format,t.pixelType,l)}}};t.prototype._setMipmap=function e(t,i,n){var r=this;var s=O(this._format);var a={width:this._width,height:this._height,faceIndex:0,flipY:i,premultiplyAlpha:n,level:0,image:null};for(var l=0;l<t.length;++l){var _=t[l];a.level=l;a.width=r._width>>l;a.height=r._height>>l;for(var o=0;o<6;++o){a.faceIndex=o;a.image=_[o];r._setImage(s,a)}}};t.prototype._setTexInfo=function e(){var t=this._device._gl;t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,N(t,this._minFilter,this._hasMipmap?this._mipFilter:-1));t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,N(t,this._magFilter,-1));t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,this._wrapS);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,this._wrapT);var i=this._device.ext("EXT_texture_filter_anisotropic");if(i){t.texParameteri(t.TEXTURE_CUBE_MAP,i.TEXTURE_MAX_ANISOTROPY_EXT,this._anisotropy)}};return t}(H);var j=function e(t,i,n,r){this._device=t;this._format=i;this._width=n;this._height=r;var s=t._gl;this._glID=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,this._glID);s.renderbufferStorage(s.RENDERBUFFER,i,n,r);s.bindRenderbuffer(s.RENDERBUFFER,null)};j.prototype.destroy=function e(){if(this._glID===null){console.error("The render-buffer already destroyed");return}var t=this._device._gl;t.bindRenderbuffer(t.RENDERBUFFER,null);t.deleteRenderbuffer(this._glID);this._glID=null};var z=function e(t,i,n,r){this._device=t;this._width=i;this._height=n;this._colors=r.colors||[];this._depth=r.depth||null;this._stencil=r.stencil||null;this._depthStencil=r.depthStencil||null;this._glID=t._gl.createFramebuffer()};z.prototype.destroy=function e(){if(this._glID===null){console.error("The frame-buffer already destroyed");return}var t=this._device._gl;t.deleteFramebuffer(this._glID);this._glID=null};var Q={blend:false,blendSep:false,blendColor:4294967295,blendEq:I.BLEND_FUNC_ADD,blendAlphaEq:I.BLEND_FUNC_ADD,blendSrc:I.BLEND_ONE,blendDst:I.BLEND_ZERO,blendSrcAlpha:I.BLEND_ONE,blendDstAlpha:I.BLEND_ZERO,depthTest:false,depthWrite:false,depthFunc:I.DS_FUNC_LESS,stencilTest:false,stencilSep:false,stencilFuncFront:I.DS_FUNC_ALWAYS,stencilRefFront:0,stencilMaskFront:255,stencilFailOpFront:I.STENCIL_OP_KEEP,stencilZFailOpFront:I.STENCIL_OP_KEEP,stencilZPassOpFront:I.STENCIL_OP_KEEP,stencilWriteMaskFront:255,stencilFuncBack:I.DS_FUNC_ALWAYS,stencilRefBack:0,stencilMaskBack:255,stencilFailOpBack:I.STENCIL_OP_KEEP,stencilZFailOpBack:I.STENCIL_OP_KEEP,stencilZPassOpBack:I.STENCIL_OP_KEEP,stencilWriteMaskBack:255,cullMode:I.CULL_BACK,primitiveType:I.PT_TRIANGLES,maxStream:-1,vertexBuffers:[],vertexBufferOffsets:[],indexBuffer:null,textureUnits:[],program:null};var $=function e(){this.vertexBuffers=[];this.vertexBufferOffsets=[];this.textureUnits=[];this.set(Q)};$.prototype.reset=function e(){this.set(Q)};$.prototype.set=function e(t){var i=this;this.blend=t.blend;this.blendSep=t.blendSep;this.blendColor=t.blendColor;this.blendEq=t.blendEq;this.blendAlphaEq=t.blendAlphaEq;this.blendSrc=t.blendSrc;this.blendDst=t.blendDst;this.blendSrcAlpha=t.blendSrcAlpha;this.blendDstAlpha=t.blendDstAlpha;this.depthTest=t.depthTest;this.depthWrite=t.depthWrite;this.depthFunc=t.depthFunc;this.stencilTest=t.stencilTest;this.stencilSep=t.stencilSep;this.stencilFuncFront=t.stencilFuncFront;this.stencilRefFront=t.stencilRefFront;this.stencilMaskFront=t.stencilMaskFront;this.stencilFailOpFront=t.stencilFailOpFront;this.stencilZFailOpFront=t.stencilZFailOpFront;this.stencilZPassOpFront=t.stencilZPassOpFront;this.stencilWriteMaskFront=t.stencilWriteMaskFront;this.stencilFuncBack=t.stencilFuncBack;this.stencilRefBack=t.stencilRefBack;this.stencilMaskBack=t.stencilMaskBack;this.stencilFailOpBack=t.stencilFailOpBack;this.stencilZFailOpBack=t.stencilZFailOpBack;this.stencilZPassOpBack=t.stencilZPassOpBack;this.stencilWriteMaskBack=t.stencilWriteMaskBack;this.cullMode=t.cullMode;this.primitiveType=t.primitiveType;this.maxStream=t.maxStream;for(var n=0;n<t.vertexBuffers.length;++n){i.vertexBuffers[n]=t.vertexBuffers[n]}for(var r=0;r<t.vertexBufferOffsets.length;++r){i.vertexBufferOffsets[r]=t.vertexBufferOffsets[r]}this.indexBuffer=t.indexBuffer;for(var s=0;s<t.textureUnits.length;++s){i.textureUnits[s]=t.textureUnits[s]}this.program=t.program};var J=5124;var ee=5126;var te=35664;var ie=35665;var ne=35666;var re=35667;var se=35668;var ae=35669;var le=35670;var _e=35671;var oe=35672;var fe=35673;var ce=35674;var ue=35675;var pe=35676;var Te=35678;var he=35680;var Ee={};Ee[J]=function(e,t,i){e.uniform1i(t,i)};Ee[ee]=function(e,t,i){e.uniform1f(t,i)};Ee[te]=function(e,t,i){e.uniform2fv(t,i)};Ee[ie]=function(e,t,i){e.uniform3fv(t,i)};Ee[ne]=function(e,t,i){e.uniform4fv(t,i)};Ee[re]=function(e,t,i){e.uniform2iv(t,i)};Ee[se]=function(e,t,i){e.uniform3iv(t,i)};Ee[ae]=function(e,t,i){e.uniform4iv(t,i)};Ee[le]=function(e,t,i){e.uniform1i(t,i)};Ee[_e]=function(e,t,i){e.uniform2iv(t,i)};Ee[oe]=function(e,t,i){e.uniform3iv(t,i)};Ee[fe]=function(e,t,i){e.uniform4iv(t,i)};Ee[ce]=function(e,t,i){e.uniformMatrix2fv(t,false,i)};Ee[ue]=function(e,t,i){e.uniformMatrix3fv(t,false,i)};Ee[pe]=function(e,t,i){e.uniformMatrix4fv(t,false,i)};Ee[Te]=function(e,t,i){e.uniform1i(t,i)};Ee[he]=function(e,t,i){e.uniform1i(t,i)};var de={};de[J]=function(e,t,i){e.uniform1iv(t,i)};de[ee]=function(e,t,i){e.uniform1fv(t,i)};de[te]=function(e,t,i){e.uniform2fv(t,i)};de[ie]=function(e,t,i){e.uniform3fv(t,i)};de[ne]=function(e,t,i){e.uniform4fv(t,i)};de[re]=function(e,t,i){e.uniform2iv(t,i)};de[se]=function(e,t,i){e.uniform3iv(t,i)};de[ae]=function(e,t,i){e.uniform4iv(t,i)};de[le]=function(e,t,i){e.uniform1iv(t,i)};de[_e]=function(e,t,i){e.uniform2iv(t,i)};de[oe]=function(e,t,i){e.uniform3iv(t,i)};de[fe]=function(e,t,i){e.uniform4iv(t,i)};de[ce]=function(e,t,i){e.uniformMatrix2fv(t,false,i)};de[ue]=function(e,t,i){e.uniformMatrix3fv(t,false,i)};de[pe]=function(e,t,i){e.uniformMatrix4fv(t,false,i)};de[Te]=function(e,t,i){e.uniform1iv(t,i)};de[he]=function(e,t,i){e.uniform1iv(t,i)};function Fe(e,t,i){if(t.blend!==i.blend){if(!i.blend){e.disable(e.BLEND);return}e.enable(e.BLEND);if(i.blendSrc===I.BLEND_CONSTANT_COLOR||i.blendSrc===I.BLEND_ONE_MINUS_CONSTANT_COLOR||i.blendDst===I.BLEND_CONSTANT_COLOR||i.blendDst===I.BLEND_ONE_MINUS_CONSTANT_COLOR){e.blendColor((i.blendColor>>24)/255,(i.blendColor>>16&255)/255,(i.blendColor>>8&255)/255,(i.blendColor&255)/255)}if(i.blendSep){e.blendFuncSeparate(i.blendSrc,i.blendDst,i.blendSrcAlpha,i.blendDstAlpha);e.blendEquationSeparate(i.blendEq,i.blendAlphaEq)}else{e.blendFunc(i.blendSrc,i.blendDst);e.blendEquation(i.blendEq)}return}if(i.blend===false){return}if(t.blendColor!==i.blendColor){e.blendColor((i.blendColor>>24)/255,(i.blendColor>>16&255)/255,(i.blendColor>>8&255)/255,(i.blendColor&255)/255)}if(t.blendSep!==i.blendSep){if(i.blendSep){e.blendFuncSeparate(i.blendSrc,i.blendDst,i.blendSrcAlpha,i.blendDstAlpha);e.blendEquationSeparate(i.blendEq,i.blendAlphaEq)}else{e.blendFunc(i.blendSrc,i.blendDst);e.blendEquation(i.blendEq)}return}if(i.blendSep){if(t.blendSrc!==i.blendSrc||t.blendDst!==i.blendDst||t.blendSrcAlpha!==i.blendSrcAlpha||t.blendDstAlpha!==i.blendDstAlpha){e.blendFuncSeparate(i.blendSrc,i.blendDst,i.blendSrcAlpha,i.blendDstAlpha)}if(t.blendEq!==i.blendEq||t.blendAlphaEq!==i.blendAlphaEq){e.blendEquationSeparate(i.blendEq,i.blendAlphaEq)}}else{if(t.blendSrc!==i.blendSrc||t.blendDst!==i.blendDst){e.blendFunc(i.blendSrc,i.blendDst)}if(t.blendEq!==i.blendEq){e.blendEquation(i.blendEq)}}}function me(e,t,i){if(t.depthTest!==i.depthTest){if(!i.depthTest){e.disable(e.DEPTH_TEST);return}e.enable(e.DEPTH_TEST);e.depthFunc(i.depthFunc);e.depthMask(i.depthWrite);return}if(t.depthWrite!==i.depthWrite){e.depthMask(i.depthWrite)}if(i.depthTest===false){if(i.depthWrite){i.depthTest=true;i.depthFunc=I.DS_FUNC_ALWAYS;e.enable(e.DEPTH_TEST);e.depthFunc(i.depthFunc)}return}if(t.depthFunc!==i.depthFunc){e.depthFunc(i.depthFunc)}}function Re(e,t,i){if(i.stencilTest!==t.stencilTest){if(!i.stencilTest){e.disable(e.STENCIL_TEST);return}e.enable(e.STENCIL_TEST);if(i.stencilSep){e.stencilFuncSeparate(e.FRONT,i.stencilFuncFront,i.stencilRefFront,i.stencilMaskFront);e.stencilMaskSeparate(e.FRONT,i.stencilWriteMaskFront);e.stencilOpSeparate(e.FRONT,i.stencilFailOpFront,i.stencilZFailOpFront,i.stencilZPassOpFront);e.stencilFuncSeparate(e.BACK,i.stencilFuncBack,i.stencilRefBack,i.stencilMaskBack);e.stencilMaskSeparate(e.BACK,i.stencilWriteMaskBack);e.stencilOpSeparate(e.BACK,i.stencilFailOpBack,i.stencilZFailOpBack,i.stencilZPassOpBack)}else{e.stencilFunc(i.stencilFuncFront,i.stencilRefFront,i.stencilMaskFront);e.stencilMask(i.stencilWriteMaskFront);e.stencilOp(i.stencilFailOpFront,i.stencilZFailOpFront,i.stencilZPassOpFront)}return}if(!i.stencilTest){return}if(t.stencilSep!==i.stencilSep){if(i.stencilSep){e.stencilFuncSeparate(e.FRONT,i.stencilFuncFront,i.stencilRefFront,i.stencilMaskFront);e.stencilMaskSeparate(e.FRONT,i.stencilWriteMaskFront);e.stencilOpSeparate(e.FRONT,i.stencilFailOpFront,i.stencilZFailOpFront,i.stencilZPassOpFront);e.stencilFuncSeparate(e.BACK,i.stencilFuncBack,i.stencilRefBack,i.stencilMaskBack);e.stencilMaskSeparate(e.BACK,i.stencilWriteMaskBack);e.stencilOpSeparate(e.BACK,i.stencilFailOpBack,i.stencilZFailOpBack,i.stencilZPassOpBack)}else{e.stencilFunc(i.stencilFuncFront,i.stencilRefFront,i.stencilMaskFront);e.stencilMask(i.stencilWriteMaskFront);e.stencilOp(i.stencilFailOpFront,i.stencilZFailOpFront,i.stencilZPassOpFront)}return}if(i.stencilSep){if(t.stencilFuncFront!==i.stencilFuncFront||t.stencilRefFront!==i.stencilRefFront||t.stencilMaskFront!==i.stencilMaskFront){e.stencilFuncSeparate(e.FRONT,i.stencilFuncFront,i.stencilRefFront,i.stencilMaskFront)}if(t.stencilWriteMaskFront!==i.stencilWriteMaskFront){e.stencilMaskSeparate(e.FRONT,i.stencilWriteMaskFront)}if(t.stencilFailOpFront!==i.stencilFailOpFront||t.stencilZFailOpFront!==i.stencilZFailOpFront||t.stencilZPassOpFront!==i.stencilZPassOpFront){e.stencilOpSeparate(e.FRONT,i.stencilFailOpFront,i.stencilZFailOpFront,i.stencilZPassOpFront)}if(t.stencilFuncBack!==i.stencilFuncBack||t.stencilRefBack!==i.stencilRefBack||t.stencilMaskBack!==i.stencilMaskBack){e.stencilFuncSeparate(e.BACK,i.stencilFuncBack,i.stencilRefBack,i.stencilMaskBack)}if(t.stencilWriteMaskBack!==i.stencilWriteMaskBack){e.stencilMaskSeparate(e.BACK,i.stencilWriteMaskBack)}if(t.stencilFailOpBack!==i.stencilFailOpBack||t.stencilZFailOpBack!==i.stencilZFailOpBack||t.stencilZPassOpBack!==i.stencilZPassOpBack){e.stencilOpSeparate(e.BACK,i.stencilFailOpBack,i.stencilZFailOpBack,i.stencilZPassOpBack)}}else{if(t.stencilFuncFront!==i.stencilFuncFront||t.stencilRefFront!==i.stencilRefFront||t.stencilMaskFront!==i.stencilMaskFront){e.stencilFunc(i.stencilFuncFront,i.stencilRefFront,i.stencilMaskFront)}if(t.stencilWriteMaskFront!==i.stencilWriteMaskFront){e.stencilMask(i.stencilWriteMaskFront)}if(t.stencilFailOpFront!==i.stencilFailOpFront||t.stencilZFailOpFront!==i.stencilZFailOpFront||t.stencilZPassOpFront!==i.stencilZPassOpFront){e.stencilOp(i.stencilFailOpFront,i.stencilZFailOpFront,i.stencilZPassOpFront)}}}function ve(e,t,i){if(t.cullMode===i.cullMode){return}if(i.cullMode===I.CULL_NONE){e.disable(e.CULL_FACE);return}e.enable(e.CULL_FACE);e.cullFace(i.cullMode)}function Ae(e,t,i){var n=false;if(i.maxStream===-1){console.warn("VertexBuffer not assigned, please call setVertexBuffer before every draw.");return}if(t.maxStream!==i.maxStream){n=true}else if(t.program!==i.program){n=true}else{for(var r=0;r<i.maxStream+1;++r){if(t.vertexBuffers[r]!==i.vertexBuffers[r]||t.vertexBufferOffsets[r]!==i.vertexBufferOffsets[r]){n=true;break}}}if(n){for(var s=0;s<i.maxStream+1;++s){var a=i.vertexBuffers[s];var l=i.vertexBufferOffsets[s];if(!a){continue}e.bindBuffer(e.ARRAY_BUFFER,a._glID);for(var _=0;_<i.program._attributes.length;++_){var o=i.program._attributes[_];var f=a._format.element(o.name);if(!f){console.warn("Can not find vertex attribute: "+o.name);continue}e.enableVertexAttribArray(o.location);e.vertexAttribPointer(o.location,f.num,f.type,f.normalize,f.stride,f.offset+l*f.stride)}}}}function xe(e,t,i){for(var n=0;n<i.textureUnits.length;++n){if(t.textureUnits[n]!==i.textureUnits[n]){var r=i.textureUnits[n];e.activeTexture(e.TEXTURE0+n);e.bindTexture(r._target,r._glID)}}}function Se(e,t,i,n){if(n===void 0)n=0;if(i instanceof K){e.framebufferTexture2D(e.FRAMEBUFFER,t,e.TEXTURE_2D,i._glID,0)}else if(i instanceof q){e.framebufferTexture2D(e.FRAMEBUFFER,t,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,i._glID,0)}else{e.framebufferRenderbuffer(e.FRAMEBUFFER,t,e.RENDERBUFFER,i._glID)}}var Be=function e(t,i){var n;i=i||{};if(i.alpha===undefined){i.alpha=false}if(i.stencil===undefined){i.stencil=true}if(i.depth===undefined){i.depth=true}if(i.antialias===undefined){i.antialias=false}if(i.preserveDrawingBuffer===undefined){i.preserveDrawingBuffer=false}try{n=t.getContext("webgl",i)}catch(e){console.error(e);return}this._gl=n;this._extensions={};this._caps={};this._stats={texture:0,vb:0,ib:0,drawcalls:0};this._current=new $;this._next=new $;this._uniforms={};this._vx=this._vy=this._vw=this._vh=0;this._sx=this._sy=this._sw=this._sh=0;this._framebuffer=null;this._initExtensions(["EXT_texture_filter_anisotropic","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","WEBGL_draw_buffers"]);this._initCaps();this._initStates()};Be.prototype._initExtensions=function e(t){var i=this;var n=this._gl;for(var r=0;r<t.length;++r){var s=t[r];try{var a=n.getExtension(s);if(a){i._extensions[s]=a}}catch(e){console.error(e)}}};Be.prototype._initCaps=function e(){var t=this._gl;var i=this.ext("WEBGL_draw_buffers");this._caps.maxVertexTextures=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS);this._caps.maxFragUniforms=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS);this._caps.maxTextureUnits=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this._caps.maxDrawBuffers=i?t.getParameter(i.MAX_DRAW_BUFFERS_WEBGL):1;this._caps.maxColorAttachments=i?t.getParameter(i.MAX_COLOR_ATTACHMENTS_WEBGL):1};Be.prototype._initStates=function e(){var t=this._gl;t.disable(t.BLEND);t.blendFunc(t.ONE,t.ZERO);t.blendEquation(t.FUNC_ADD);t.blendColor(1,1,1,1);t.colorMask(true,true,true,true);t.enable(t.CULL_FACE);t.cullFace(t.BACK);t.disable(t.DEPTH_TEST);t.depthFunc(t.LESS);t.depthMask(false);t.disable(t.POLYGON_OFFSET_FILL);t.depthRange(0,1);t.disable(t.STENCIL_TEST);t.stencilFunc(t.ALWAYS,0,255);t.stencilMask(255);t.stencilOp(t.KEEP,t.KEEP,t.KEEP);t.clearDepth(1);t.clearColor(0,0,0,0);t.clearStencil(0);t.disable(t.SCISSOR_TEST)};Be.prototype._restoreTexture=function e(t){var i=this._gl;var n=this._current.textureUnits[t];if(n){i.bindTexture(n._target,n._glID)}else{i.bindTexture(i.TEXTURE_2D,null)}};Be.prototype.ext=function e(t){return this._extensions[t]};Be.prototype.setFrameBuffer=function e(t){var i=this;if(this._framebuffer===t){return}this._framebuffer=t;var n=this._gl;if(t===null){n.bindFramebuffer(n.FRAMEBUFFER,null);return}n.bindFramebuffer(n.FRAMEBUFFER,t._glID);var r=this._framebuffer._colors.length;for(var s=0;s<r;++s){var a=i._framebuffer._colors[s];Se(n,n.COLOR_ATTACHMENT0+s,a)}for(var l=r;l<this._caps.maxColorAttachments;++l){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+l,n.TEXTURE_2D,null,0)}if(this._framebuffer._depth){Se(n,n.DEPTH_ATTACHMENT,this._framebuffer._depth)}if(this._framebuffer._stencil){Se(n,n.STENCIL_ATTACHMENT,t._stencil)}if(this._framebuffer._depthStencil){Se(n,n.DEPTH_STENCIL_ATTACHMENT,t._depthStencil)}};Be.prototype.setViewport=function e(t,i,n,r){if(this._vx!==t||this._vy!==i||this._vw!==n||this._vh!==r){this._gl.viewport(t,i,n,r);this._vx=t;this._vy=i;this._vw=n;this._vh=r}};Be.prototype.setScissor=function e(t,i,n,r){if(this._sx!==t||this._sy!==i||this._sw!==n||this._sh!==r){this._gl.scissor(t,i,n,r);this._sx=t;this._sy=i;this._sw=n;this._sh=r}};Be.prototype.clear=function e(t){var i=this._gl;var n=0;if(t.color!==undefined){n|=i.COLOR_BUFFER_BIT;i.clearColor(t.color[0],t.color[1],t.color[2],t.color[3])}if(t.depth!==undefined){n|=i.DEPTH_BUFFER_BIT;i.clearDepth(t.depth);i.enable(i.DEPTH_TEST);i.depthMask(true);i.depthFunc(i.ALWAYS)}if(t.stencil!==undefined){n|=i.STENCIL_BUFFER_BIT;i.clearStencil(t.stencil)}i.clear(n);if(t.depth!==undefined){if(this._current.depthTest===false){i.disable(i.DEPTH_TEST)}else{if(this._current.depthWrite===false){i.depthMask(false)}if(this._current.depthFunc!==I.DS_FUNC_ALWAYS){i.depthFunc(this._current.depthFunc)}}}};Be.prototype.enableBlend=function e(){this._next.blend=true};Be.prototype.enableDepthTest=function e(){this._next.depthTest=true};Be.prototype.enableDepthWrite=function e(){this._next.depthWrite=true};Be.prototype.enableStencilTest=function e(){this._next.stencilTest=true};Be.prototype.setStencilFunc=function e(t,i,n){this._next.stencilSep=false;this._next.stencilFuncFront=this._next.stencilFuncBack=t;this._next.stencilRefFront=this._next.stencilRefBack=i;this._next.stencilMaskFront=this._next.stencilMaskBack=n};Be.prototype.setStencilFuncFront=function e(t,i,n){this._next.stencilSep=true;this._next.stencilFuncFront=t;this._next.stencilRefFront=i;this._next.stencilMaskFront=n};Be.prototype.setStencilFuncBack=function e(t,i,n){this._next.stencilSep=true;this._next.stencilFuncBack=t;this._next.stencilRefBack=i;this._next.stencilMaskBack=n};Be.prototype.setStencilOp=function e(t,i,n,r){this._next.stencilFailOpFront=this._next.stencilFailOpBack=t;this._next.stencilZFailOpFront=this._next.stencilZFailOpBack=i;this._next.stencilZPassOpFront=this._next.stencilZPassOpBack=n;this._next.stencilWriteMaskFront=this._next.stencilWriteMaskBack=r};Be.prototype.setStencilOpFront=function e(t,i,n,r){this._next.stencilSep=true;this._next.stencilFailOpFront=t;this._next.stencilZFailOpFront=i;this._next.stencilZPassOpFront=n;this._next.stencilWriteMaskFront=r};Be.prototype.setStencilOpBack=function e(t,i,n,r){this._next.stencilSep=true;this._next.stencilFailOpBack=t;this._next.stencilZFailOpBack=i;this._next.stencilZPassOpBack=n;this._next.stencilWriteMaskBack=r};Be.prototype.setDepthFunc=function e(t){this._next.depthFunc=t};Be.prototype.setBlendColor32=function e(t){this._next.blendColor=t};Be.prototype.setBlendColor=function e(t,i,n,r){this._next.blendColor=(t*255<<24|i*255<<16|n*255<<8|r*255)>>>0};Be.prototype.setBlendFunc=function e(t,i){this._next.blendSep=false;this._next.blendSrc=t;this._next.blendDst=i};Be.prototype.setBlendFuncSep=function e(t,i,n,r){this._next.blendSep=true;this._next.blendSrc=t;this._next.blendDst=i;this._next.blendSrcAlpha=n;this._next.blendDstAlpha=r};Be.prototype.setBlendEq=function e(t){this._next.blendSep=false;this._next.blendEq=t};Be.prototype.setBlendEqSep=function e(t,i){this._next.blendSep=true;this._next.blendEq=t;this._next.blendAlphaEq=i};Be.prototype.setCullMode=function e(t){this._next.cullMode=t};Be.prototype.setVertexBuffer=function e(t,i,n){if(n===void 0)n=0;this._next.vertexBuffers[t]=i;this._next.vertexBufferOffsets[t]=n;if(this._next.maxStream<t){this._next.maxStream=t}};Be.prototype.setIndexBuffer=function e(t){this._next.indexBuffer=t};Be.prototype.setProgram=function e(t){this._next.program=t};Be.prototype.setTexture=function e(t,i,n){if(n>=this._caps.maxTextureUnits){console.warn("Can not set texture "+t+" at stage "+n+", max texture exceed: "+this._caps.maxTextureUnits);return}this._next.textureUnits[n]=i;this.setUniform(t,n)};Be.prototype.setTextureArray=function e(t,i,n){var r=this;var s=i.length;if(s>=this._caps.maxTextureUnits){console.warn("Can not set "+s+" textures for "+t+", max texture exceed: "+this._caps.maxTextureUnits);return}for(var a=0;a<s;++a){var l=n[a];r._next.textureUnits[l]=i[a]}this.setUniform(t,n)};Be.prototype.setUniform=function e(t,i){var n=this._uniforms[t];if(!n){n={dirty:true,value:i}}else{n.dirty=true;n.value=i}this._uniforms[t]=n};Be.prototype.setPrimitiveType=function e(t){this._next.primitiveType=t};Be.prototype.draw=function e(t,i){var n=this;var r=this._gl;var s=this._current;var a=this._next;Fe(r,s,a);me(r,s,a);Re(r,s,a);ve(r,s,a);Ae(r,s,a);if(s.indexBuffer!==a.indexBuffer){r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,a.indexBuffer?a.indexBuffer._glID:null)}var l=false;if(s.program!==a.program){if(a.program._linked){r.useProgram(a.program._glID)}else{console.warn("Failed to use program: has not linked yet.")}l=true}xe(r,s,a);for(var _=0;_<a.program._uniforms.length;++_){var o=a.program._uniforms[_];var f=n._uniforms[o.name];if(!f){continue}if(!l&&!f.dirty){continue}f.dirty=false;var c=o.size===undefined?Ee[o.type]:de[o.type];if(!c){console.warn("Can not find commit function for uniform "+o.name);continue}c(r,o.location,f.value)}if(a.indexBuffer){r.drawElements(this._next.primitiveType,i,a.indexBuffer._format,t*a.indexBuffer._bytes)}else{r.drawArrays(this._next.primitiveType,t,i)}this._stats.drawcalls+=1;s.set(a);a.reset()};var Pe={VertexFormat:D,IndexBuffer:y,VertexBuffer:k,Program:G,Texture:H,Texture2D:K,TextureCube:q,RenderBuffer:j,FrameBuffer:z,Device:Be,attrTypeBytes:M,glFilter:N,glTextureFmt:O};Object.assign(Pe,I);return Pe}();
//# sourceMappingURL=gfx.min.js.map