var gfx=function(){"use strict";let _={USAGE_STATIC:35044,USAGE_DYNAMIC:35048,USAGE_STREAM:35040,INDEX_FMT_UINT8:5121,INDEX_FMT_UINT16:5123,INDEX_FMT_UINT32:5125,ATTR_POSITION:"a_position",ATTR_NORMAL:"a_normal",ATTR_TANGENT:"a_tangent",ATTR_BITANGENT:"a_bitangent",ATTR_WEIGHT:"a_weight",ATTR_INDICES:"a_indices",ATTR_COLOR:"a_color",ATTR_COLOR0:"a_color0",ATTR_COLOR1:"a_color1",ATTR_UV:"a_uv",ATTR_UV0:"a_uv0",ATTR_UV1:"a_uv1",ATTR_UV2:"a_uv2",ATTR_UV3:"a_uv3",ATTR_UV4:"a_uv4",ATTR_UV5:"a_uv5",ATTR_UV6:"a_uv6",ATTR_UV7:"a_uv7",ATTR_TYPE_INT8:5120,ATTR_TYPE_UINT8:5121,ATTR_TYPE_INT16:5122,ATTR_TYPE_UINT16:5123,ATTR_TYPE_INT32:5124,ATTR_TYPE_UINT32:5125,ATTR_TYPE_FLOAT32:5126,FILTER_NEAREST:9728,FILTER_LINEAR:9729,FILTER_NEAREST_MIPMAP_NEAREST:9984,FILTER_LINEAR_MIPMAP_NEAREST:9985,FILTER_NEAREST_MIPMAP_LINEAR:9986,FILTER_LINEAR_MIPMAP_LINEAR:9987,WRAP_REPEAT:10497,WRAP_CLAMP:33071,WRAP_MIRROR:33648,TEXTURE_FMT_DXT1:0,TEXTURE_FMT_DXT3:1,TEXTURE_FMT_DXT5:2,TEXTURE_FMT_ETC1:3,TEXTURE_FMT_PVRTC_2BPP_RGB_1:4,TEXTURE_FMT_PVRTC_2BPP_RGBA_1:5,TEXTURE_FMT_PVRTC_4BPP_RGB_1:6,TEXTURE_FMT_PVRTC_4BPP_RGBA_1:7,TEXTURE_FMT_A8:8,TEXTURE_FMT_L8:9,TEXTURE_FMT_L8_A8:10,TEXTURE_FMT_R5_G6_B5:11,TEXTURE_FMT_R5_G5_B5_A1:12,TEXTURE_FMT_R4_G4_B4_A4:13,TEXTURE_FMT_RGB8:14,TEXTURE_FMT_RGBA8:15,TEXTURE_FMT_RGB16F:16,TEXTURE_FMT_RGBA16F:17,TEXTURE_FMT_RGB32F:18,TEXTURE_FMT_RGBA32F:19,TEXTURE_FMT_R32F:20,TEXTURE_FMT_111110F:21,TEXTURE_FMT_SRGB:22,TEXTURE_FMT_SRGBA:23,TEXTURE_FMT_DEPTH:24,TEXTURE_FMT_DEPTHSTENCIL:25};function e(e){if(e===_.ATTR_TYPE_INT8){return 1}else if(e===_.ATTR_TYPE_UINT8){return 1}else if(e===_.ATTR_TYPE_INT16){return 2}else if(e===_.ATTR_TYPE_UINT16){return 2}else if(e===_.ATTR_TYPE_INT32){return 4}else if(e===_.ATTR_TYPE_UINT32){return 4}else if(e===_.ATTR_TYPE_FLOAT32){return 4}console.warn(`Unknown ATTR_TYPE: ${e}`);return 0}class t{constructor(e,t,i,T,E,r){this._device=e;this._format=t;this._usage=i;this._persist=r;let s=0;if(t===_.INDEX_FMT_UINT8){s=E}else if(t===_.INDEX_FMT_UINT16){s=2*E}else if(t===_.INDEX_FMT_UINT32){s=4*E}this._bytes=s;this._id=e._gl.createBuffer();this._data=null;this.update(0,T);e._vram.ib+=s}destroy(){let _=this.device.gl;_.deleteBuffer(this._id);this.device._vram.ib-=this.bytes;this._id=-1}update(_,e){if(this._id===-1){console.error("The buffer is destroyed");return}if(e&&e.byteLength+_>=this._bytes){console.error("Failed to update data, bytes exceed.");return}let t=this._device._gl;let i=this._usage;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._id);if(!e){t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._bytes,i)}else{if(_){t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,e,i)}else{t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,i)}}t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null);if(this._persist){if(this._data){this._data.set(e,_)}else{this._data=e}}}}class i{constructor(_,e,t,i,T,E){this._device=_;this._format=e;this._usage=t;this._persist=E;this._bytes=this._format._bytes*T;this._id=_._gl.createBuffer();this._data=null;this.update(0,i);_._vram.vb+=this._bytes}destroy(){let _=this.device.gl;_.deleteBuffer(this._id);this.device._vram.vb-=this.bytes;this._id=-1}update(_,e){if(this._id===-1){console.error("The buffer is destroyed");return}if(e&&e.byteLength+_>=this._bytes){console.error("Failed to update data, bytes exceed.");return}let t=this._device._gl;let i=this._usage;t.bindBuffer(t.ARRAY_BUFFER,this._id);if(!e){t.bufferData(t.ARRAY_BUFFER,this._bytes,i)}else{if(_){t.bufferSubData(t.ARRAY_BUFFER,e,i)}else{t.bufferData(t.ARRAY_BUFFER,e,i)}}t.bindBuffer(t.ARRAY_BUFFER,null);if(this._persist){if(this._data){this._data.set(e,_)}else{this._data=e}}}}class T{constructor(){}}class E{constructor(e){this._device=e;this._width=4;this._height=4;this._mipmaps=true;this._anisotropy=1;this._minFilter=_.FILTER_LINEAR_MIPMAP_LINEAR;this._magFilter=_.FILTER_LINEAR;this._wrapS=_.WRAP_REPEAT;this._wrapT=_.WRAP_REPEAT;this._format=_.TEXTURE_FMT_RGBA8}destroy(){let _=this.device.gl;_.deleteTexture(this._id);this.device._vram.tex-=this.bytes;this._id=-1}update(){}}class r extends E{constructor(_,e){super(_);if(e){if(e.width!==undefined){this._width=e.width}if(e.height!==undefined){this._height=e.height}if(e.mipmpas!==undefined){this._mipmaps=e.mipmpas}if(e.anisotropy!==undefined){this._anisotropy=e.anisotropy}if(e.minFilter!==undefined){this._minFilter=e.minFilter}if(e.magFilter!==undefined){this._magFilter=e.magFilter}if(e.wrapS!==undefined){this._wrapS=e.wrapS}if(e.wrapT!==undefined){this._wrapT=e.wrapT}if(e.format!==undefined){this._format=e.format}}}update(){}setStates(_){let e=this._device._gl;e.activeTexture(e.TEXTURE0);e.bindTexture(e.TEXTURE_2D,this._id);if(_.minFilter!==undefined&&_.minFilter!==this._minFilter){this._minFilter=_.minFilter;e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,_.minFilter)}if(_.magFilter!==undefined&&_.magFilter!==this._magFilter){this._magFilter=_.magFilter;e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,_.magFilter)}e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,_.wrapS);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,_.wrapT);if(this._device.hasExt("EXT_texture_filter_anisotropic")){e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY_EXT,_.anisotropic)}if(_.genMipmaps){e.hint(e.GENERATE_MIPMAP_HINT,_.mipmapHint);e.generateMipmap(e.TEXTURE_2D)}e.bindTexture(e.TEXTURE_2D,null)}}class s{constructor(_,e){let t;try{t=_.getContext("webgl",e)}catch(_){console.error(_);return}this._gl=t;this._extensions={};this._vram={texture:0,vb:0,ib:0};this._initExtensions(["OES_vertex_array_object","OES_texture_float","OES_texture_half_float","OES_texture_half_float_linear","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_atc","EXT_texture_filter_anisotropic"])}_initExtensions(_){let e=this._gl;for(let t=0;t<_.length;++t){let i=_[t];try{let _=e.getExtension(i);if(_){this._extensions[i]=_}}catch(_){console.error(_)}}}hasExt(_){return this._extensions[_]!==undefined}draw(_,e){}}let R={IndexBuffer:t,VertexBuffer:i,Shader:T,Texture:E,Texture2D:r,Device:s,attrTypeBytes:e};Object.assign(R,_);return R}();
//# sourceMappingURL=./dist/gfx.min.js.map