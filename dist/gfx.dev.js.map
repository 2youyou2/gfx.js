{"version":3,"file":"gfx.dev.js","sources":["../lib/enums.js","../lib/index-buffer.js","../lib/vertex-buffer.js","../lib/shader.js","../lib/texture.js","../lib/texture-2d.js","../lib/device.js","../index.js"],"sourcesContent":["const GL_NEAREST = 9728;                // gl.NEAREST\nconst GL_LINEAR = 9729;                 // gl.LINEAR\nconst GL_NEAREST_MIPMAP_NEAREST = 9984; // gl.NEAREST_MIPMAP_NEAREST\nconst GL_LINEAR_MIPMAP_NEAREST = 9985;  // gl.LINEAR_MIPMAP_NEAREST\nconst GL_NEAREST_MIPMAP_LINEAR = 9986;  // gl.NEAREST_MIPMAP_LINEAR\nconst GL_LINEAR_MIPMAP_LINEAR = 9987;   // gl.LINEAR_MIPMAP_LINEAR\n\n// const GL_BYTE = 5120;                     // gl.BYTE\nconst GL_UNSIGNED_BYTE = 5121;            // gl.UNSIGNED_BYTE\n// const GL_SHORT = 5122;                    // gl.SHORT\nconst GL_UNSIGNED_SHORT = 5123;           // gl.UNSIGNED_SHORT\nconst GL_FLOAT = 5126;                    // gl.FLOAT\nconst GL_UNSIGNED_SHORT_5_6_5 = 33635;    // gl.UNSIGNED_SHORT_5_6_5\nconst GL_UNSIGNED_SHORT_4_4_4_4 = 32819;  // gl.UNSIGNED_SHORT_4_4_4_4\nconst GL_UNSIGNED_SHORT_5_5_5_1 = 32820;  // gl.UNSIGNED_SHORT_5_5_5_1\nconst GL_HALF_FLOAT_OES = 36193;          // gl.HALF_FLOAT_OES\n\nconst GL_DEPTH_COMPONENT = 6402; // gl.DEPTH_COMPONENT\n\nconst GL_ALPHA = 6406;            // gl.ALPHA\nconst GL_RGB = 6407;              // gl.RGB\nconst GL_RGBA = 6408;             // gl.RGBA\nconst GL_LUMINANCE = 6409;        // gl.LUMINANCE\nconst GL_LUMINANCE_ALPHA = 6410;  // gl.LUMINANCE_ALPHA\n\nconst GL_COMPRESSED_RGB_S3TC_DXT1_EXT = 0x83F0;   // ext.COMPRESSED_RGB_S3TC_DXT1_EXT\nconst GL_COMPRESSED_RGBA_S3TC_DXT1_EXT = 0x83F1;  // ext.COMPRESSED_RGBA_S3TC_DXT1_EXT\nconst GL_COMPRESSED_RGBA_S3TC_DXT3_EXT = 0x83F2;  // ext.COMPRESSED_RGBA_S3TC_DXT3_EXT\nconst GL_COMPRESSED_RGBA_S3TC_DXT5_EXT = 0x83F3;  // ext.COMPRESSED_RGBA_S3TC_DXT5_EXT\n\nconst GL_COMPRESSED_RGB_PVRTC_4BPPV1_IMG = 0x8C00;  // ext.COMPRESSED_RGB_PVRTC_4BPPV1_IMG\nconst GL_COMPRESSED_RGB_PVRTC_2BPPV1_IMG = 0x8C01;  // ext.COMPRESSED_RGB_PVRTC_2BPPV1_IMG\nconst GL_COMPRESSED_RGBA_PVRTC_4BPPV1_IMG = 0x8C02; // ext.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG\nconst GL_COMPRESSED_RGBA_PVRTC_2BPPV1_IMG = 0x8C03; // ext.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG\n\nconst GL_COMPRESSED_RGB_ETC1_WEBGL = 0x8D64; // ext.COMPRESSED_RGB_ETC1_WEBGL\n\n\nconst _filterGL = [\n  [ GL_NEAREST,  GL_NEAREST_MIPMAP_NEAREST, GL_NEAREST_MIPMAP_LINEAR ],\n  [ GL_LINEAR,  GL_LINEAR_MIPMAP_NEAREST, GL_LINEAR_MIPMAP_LINEAR ],\n];\n\nconst _textureFmtGL = [\n  // TEXTURE_FMT_RGB_DXT1: 0\n  { format: GL_RGB, internalFormat: GL_COMPRESSED_RGB_S3TC_DXT1_EXT, pixelType: null },\n\n  // TEXTURE_FMT_RGBA_DXT1: 1\n  { format: GL_RGBA, internalFormat: GL_COMPRESSED_RGBA_S3TC_DXT1_EXT, pixelType: null },\n\n  // TEXTURE_FMT_RGBA_DXT3: 2\n  { format: GL_RGBA, internalFormat: GL_COMPRESSED_RGBA_S3TC_DXT3_EXT, pixelType: null },\n\n  // TEXTURE_FMT_RGBA_DXT5: 3\n  { format: GL_RGBA, internalFormat: GL_COMPRESSED_RGBA_S3TC_DXT5_EXT, pixelType: null },\n\n  // TEXTURE_FMT_RGB_ETC1: 4\n  { format: GL_RGB, internalFormat: GL_COMPRESSED_RGB_ETC1_WEBGL, pixelType: null },\n\n  // TEXTURE_FMT_RGB_PVRTC_2BPPV1: 5\n  { format: GL_RGB, internalFormat: GL_COMPRESSED_RGB_PVRTC_2BPPV1_IMG, pixelType: null },\n\n  // TEXTURE_FMT_RGBA_PVRTC_2BPPV1: 6\n  { format: GL_RGBA, internalFormat: GL_COMPRESSED_RGBA_PVRTC_2BPPV1_IMG, pixelType: null },\n\n  // TEXTURE_FMT_RGB_PVRTC_4BPPV1: 7\n  { format: GL_RGB, internalFormat: GL_COMPRESSED_RGB_PVRTC_4BPPV1_IMG, pixelType: null },\n\n  // TEXTURE_FMT_RGBA_PVRTC_4BPPV1: 8\n  { format: GL_RGBA, internalFormat: GL_COMPRESSED_RGBA_PVRTC_4BPPV1_IMG, pixelType: null },\n\n  // TEXTURE_FMT_A8: 9\n  { format: GL_ALPHA, internalFormat: GL_ALPHA, pixelType: GL_UNSIGNED_BYTE },\n\n  // TEXTURE_FMT_L8: 10\n  { format: GL_LUMINANCE, internalFormat: GL_LUMINANCE, pixelType: GL_UNSIGNED_BYTE },\n\n  // TEXTURE_FMT_L8_A8: 11\n  { format: GL_LUMINANCE_ALPHA, internalFormat: GL_LUMINANCE_ALPHA, pixelType: GL_UNSIGNED_BYTE },\n\n  // TEXTURE_FMT_R5_G6_B5: 12\n  { format: GL_RGB, internalFormat: GL_RGB, pixelType: GL_UNSIGNED_SHORT_5_6_5 },\n\n  // TEXTURE_FMT_R5_G5_B5_A1: 13\n  { format: GL_RGBA, internalFormat: GL_RGBA, pixelType: GL_UNSIGNED_SHORT_5_5_5_1 },\n\n  // TEXTURE_FMT_R4_G4_B4_A4: 14\n  { format: GL_RGBA, internalFormat: GL_RGBA, pixelType: GL_UNSIGNED_SHORT_4_4_4_4 },\n\n  // TEXTURE_FMT_RGB8: 15\n  { format: GL_RGB, internalFormat: GL_RGB, pixelType: GL_UNSIGNED_BYTE },\n\n  // TEXTURE_FMT_RGBA8: 16\n  { format: GL_RGBA, internalFormat: GL_RGBA, pixelType: GL_UNSIGNED_BYTE },\n\n  // TEXTURE_FMT_RGB16F: 17\n  { format: GL_RGB, internalFormat: GL_RGB, pixelType: GL_HALF_FLOAT_OES },\n\n  // TEXTURE_FMT_RGBA16F: 18\n  { format: GL_RGBA, internalFormat: GL_RGBA, pixelType: GL_HALF_FLOAT_OES },\n\n  // TEXTURE_FMT_RGB32F: 19\n  { format: GL_RGB, internalFormat: GL_RGB, pixelType: GL_FLOAT },\n\n  // TEXTURE_FMT_RGBA32F: 20\n  { format: GL_RGBA, internalFormat: GL_RGBA, pixelType: GL_FLOAT },\n\n  // TEXTURE_FMT_R32F: 21\n  { format: null, internalFormat: null, pixelType: null },\n\n  // TEXTURE_FMT_111110F: 22\n  { format: null, internalFormat: null, pixelType: null },\n\n  // TEXTURE_FMT_SRGB: 23\n  { format: null, internalFormat: null, pixelType: null },\n\n  // TEXTURE_FMT_SRGBA: 24\n  { format: null, internalFormat: null, pixelType: null },\n\n  // TEXTURE_FMT_DEPTH: 25\n  { format: GL_DEPTH_COMPONENT, internalFormat: GL_DEPTH_COMPONENT, pixelType: GL_UNSIGNED_SHORT },\n\n  // TEXTURE_FMT_DEPTHSTENCIL: 26\n  { format: null, internalFormat: null, pixelType: null },\n];\n\n/**\n * enums\n */\nexport let enums = {\n  // buffer usage\n  USAGE_STATIC: 35044,  // gl.STATIC_DRAW\n  USAGE_DYNAMIC: 35048, // gl.DYNAMIC_DRAW\n  USAGE_STREAM: 35040,  // gl.STREAM_DRAW\n\n  // index buffer format\n  INDEX_FMT_UINT8: 5121,  // gl.UNSIGNED_BYTE\n  INDEX_FMT_UINT16: 5123, // gl.UNSIGNED_SHORT\n  INDEX_FMT_UINT32: 5125, // gl.UNSIGNED_INT (OES_element_index_uint)\n\n  // vertex attribute semantic\n  ATTR_POSITION: 'a_position',\n  ATTR_NORMAL: 'a_normal',\n  ATTR_TANGENT: 'a_tangent',\n  ATTR_BITANGENT: 'a_bitangent',\n  ATTR_WEIGHT: 'a_weight',\n  ATTR_INDICES: 'a_indices',\n  ATTR_COLOR: 'a_color',\n  ATTR_COLOR0: 'a_color0',\n  ATTR_COLOR1: 'a_color1',\n  ATTR_UV: 'a_uv',\n  ATTR_UV0: 'a_uv0',\n  ATTR_UV1: 'a_uv1',\n  ATTR_UV2: 'a_uv2',\n  ATTR_UV3: 'a_uv3',\n  ATTR_UV4: 'a_uv4',\n  ATTR_UV5: 'a_uv5',\n  ATTR_UV6: 'a_uv6',\n  ATTR_UV7: 'a_uv7',\n\n  // vertex attribute type\n  ATTR_TYPE_INT8: 5120,    // gl.BYTE\n  ATTR_TYPE_UINT8: 5121,   // gl.UNSIGNED_BYTE\n  ATTR_TYPE_INT16: 5122,   // gl.SHORT\n  ATTR_TYPE_UINT16: 5123,  // gl.UNSIGNED_SHORT\n  ATTR_TYPE_INT32: 5124,   // gl.INT\n  ATTR_TYPE_UINT32: 5125,  // gl.UNSIGNED_INT\n  ATTR_TYPE_FLOAT32: 5126, // gl.FLOAT\n\n  // texture filter\n  FILTER_NEAREST: 0,\n  FILTER_LINEAR: 1,\n\n  // texture wrap mode\n  WRAP_REPEAT: 10497, // gl.REPEAT\n  WRAP_CLAMP: 33071,  // gl.CLAMP_TO_EDGE\n  WRAP_MIRROR: 33648, // gl.MIRRORED_REPEAT\n\n  // texture format\n  // compress formats\n  TEXTURE_FMT_RGB_DXT1: 0,\n  TEXTURE_FMT_RGBA_DXT1: 1,\n  TEXTURE_FMT_RGBA_DXT3: 2,\n  TEXTURE_FMT_RGBA_DXT5: 3,\n  TEXTURE_FMT_RGB_ETC1: 4,\n  TEXTURE_FMT_RGB_PVRTC_2BPPV1: 5,\n  TEXTURE_FMT_RGBA_PVRTC_2BPPV1: 6,\n  TEXTURE_FMT_RGB_PVRTC_4BPPV1: 7,\n  TEXTURE_FMT_RGBA_PVRTC_4BPPV1: 8,\n\n  // normal formats\n  TEXTURE_FMT_A8: 9,\n  TEXTURE_FMT_L8: 10,\n  TEXTURE_FMT_L8_A8: 11,\n  TEXTURE_FMT_R5_G6_B5: 12,\n  TEXTURE_FMT_R5_G5_B5_A1: 13,\n  TEXTURE_FMT_R4_G4_B4_A4: 14,\n  TEXTURE_FMT_RGB8: 15,\n  TEXTURE_FMT_RGBA8: 16,\n  TEXTURE_FMT_RGB16F: 17,\n  TEXTURE_FMT_RGBA16F: 18,\n  TEXTURE_FMT_RGB32F: 19,\n  TEXTURE_FMT_RGBA32F: 20,\n  TEXTURE_FMT_R32F: 21,\n  TEXTURE_FMT_111110F: 22,\n  TEXTURE_FMT_SRGB: 23,\n  TEXTURE_FMT_SRGBA: 24,\n\n  // depth formats\n  TEXTURE_FMT_DEPTH: 25,\n  TEXTURE_FMT_DEPTHSTENCIL: 26,\n};\n\n/**\n * @method attrTypeBytes\n * @param {ATTR_TYPE_*} attrType\n */\nexport function attrTypeBytes(attrType) {\n  if (attrType === enums.ATTR_TYPE_INT8) {\n    return 1;\n  } else if (attrType === enums.ATTR_TYPE_UINT8) {\n    return 1;\n  } else if (attrType === enums.ATTR_TYPE_INT16) {\n    return 2;\n  } else if (attrType === enums.ATTR_TYPE_UINT16) {\n    return 2;\n  } else if (attrType === enums.ATTR_TYPE_INT32) {\n    return 4;\n  } else if (attrType === enums.ATTR_TYPE_UINT32) {\n    return 4;\n  } else if (attrType === enums.ATTR_TYPE_FLOAT32) {\n    return 4;\n  }\n\n  console.warn(`Unknown ATTR_TYPE: ${attrType}`);\n  return 0;\n}\n\n/**\n * @method glFilter\n * @param {WebGLContext} gl\n * @param {FILTER_*} filter\n * @param {FILTER_*} mipFilter\n */\nexport function glFilter(gl, filter, mipFilter = -1) {\n  let result = _filterGL[filter][mipFilter+1];\n  if (result === undefined) {\n    console.warn(`Unknown FILTER: ${filter}`);\n    return mipFilter === -1 ? gl.LINEAR : gl.LINEAR_MIPMAP_LINEAR;\n  }\n\n  return result;\n}\n\n/**\n * @method glTextureFmt\n * @param {TEXTURE_FMT_*} fmt\n */\nexport function glTextureFmt(fmt) {\n  let result = _textureFmtGL[fmt];\n  if (result === undefined) {\n    console.warn(`Unknown TEXTURE_FMT: ${fmt}`);\n    return _textureFmtGL[enums.TEXTURE_FMT_RGBA8];\n  }\n\n  return result;\n}","import { enums } from './enums';\n\nexport default class IndexBuffer {\n  /**\n   * @constructor\n   * @param {Device} device\n   * @param {INDEX_FMT_*} format\n   * @param {USAGE_*} usage\n   * @param {ArrayBuffer} data\n   * @param {Number} numIndices\n   * @param {Boolean} persist\n   */\n  constructor(device, format, usage, data, numIndices, persist) {\n    this._device = device;\n    this._format = format;\n    this._usage = usage;\n    this._persist = persist;\n\n    // calculate bytes\n    let bytes = 0;\n    if (format === enums.INDEX_FMT_UINT8) {\n      bytes = numIndices;\n    } else if (format === enums.INDEX_FMT_UINT16) {\n      bytes = 2 * numIndices;\n    } else if (format === enums.INDEX_FMT_UINT32) {\n      bytes = 4 * numIndices;\n    }\n    this._bytes = bytes;\n\n    // update\n    this._id = device._gl.createBuffer();\n    this._data = null;\n    this.update(0, data);\n\n    // stats\n    device._vram.ib += bytes;\n  }\n\n  /**\n   * @method destroy\n   */\n  destroy() {\n    if (this._id === -1) {\n      console.error('The buffer already destroyed');\n      return;\n    }\n\n    let gl = this.device.gl;\n    gl.deleteBuffer(this._id);\n    this.device._vram.ib -= this.bytes;\n\n    this._id = -1;\n  }\n\n  /**\n   * @method update\n   * @param {Number} offset\n   * @param {ArrayBuffer} data\n   */\n  update(offset, data) {\n    if (this._id === -1) {\n      console.error('The buffer is destroyed');\n      return;\n    }\n\n    if (data && data.byteLength + offset >= this._bytes) {\n      console.error('Failed to update data, bytes exceed.');\n      return;\n    }\n\n    let gl = this._device._gl;\n    let glUsage = this._usage;\n\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._id);\n    if (!data) {\n      gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this._bytes, glUsage);\n    } else {\n      if (offset) {\n        gl.bufferSubData(gl.ELEMENT_ARRAY_BUFFER, data, glUsage);\n      } else {\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, data, glUsage);\n      }\n    }\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n\n    // store the data\n    if (this._persist) {\n      if (this._data) {\n        this._data.set(data, offset);\n      } else {\n        this._data = data;\n      }\n    }\n  }\n}","export default class VertexBuffer {\n  /**\n   * @constructor\n   * @param {Device} device\n   * @param {VertexFormat} format\n   * @param {USAGE_*} usage\n   * @param {ArrayBuffer} data\n   * @param {Number} numVertices\n   * @param {Boolean} persist\n   */\n  constructor(device, format, usage, data, numVertices, persist) {\n    this._device = device;\n    this._format = format;\n    this._usage = usage;\n    this._persist = persist;\n\n    // calculate bytes\n    this._bytes = this._format._bytes * numVertices;\n\n    // update\n    this._id = device._gl.createBuffer();\n    this._data = null;\n    this.update(0, data);\n\n    // stats\n    device._vram.vb += this._bytes;\n  }\n\n  /**\n   * @method destroy\n   */\n  destroy() {\n    if (this._id === -1) {\n      console.error('The buffer already destroyed');\n      return;\n    }\n\n    let gl = this.device.gl;\n    gl.deleteBuffer(this._id);\n    this.device._vram.vb -= this.bytes;\n\n    this._id = -1;\n  }\n\n  /**\n   * @method update\n   * @param {Number} offset\n   * @param {ArrayBuffer} data\n   */\n  update(offset, data) {\n    if (this._id === -1) {\n      console.error('The buffer is destroyed');\n      return;\n    }\n\n    if (data && data.byteLength + offset >= this._bytes) {\n      console.error('Failed to update data, bytes exceed.');\n      return;\n    }\n\n    let gl = this._device._gl;\n    let glUsage = this._usage;\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this._id);\n    if (!data) {\n      gl.bufferData(gl.ARRAY_BUFFER, this._bytes, glUsage);\n    } else {\n      if (offset) {\n        gl.bufferSubData(gl.ARRAY_BUFFER, data, glUsage);\n      } else {\n        gl.bufferData(gl.ARRAY_BUFFER, data, glUsage);\n      }\n    }\n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\n\n    // store the data\n    if (this._persist) {\n      if (this._data) {\n        this._data.set(data, offset);\n      } else {\n        this._data = data;\n      }\n    }\n  }\n}","export default class Shader {\n  /**\n   * @param {ef.GraphicsDevice} device - graphic device\n   * @param {object} options - shader definition\n   * @param {string} options.vert - vertex shader source code\n   * @param {string} options.frag - fragment shader shader source code\n   * @example\n   * let shader = new Shader(device, {\n   *   vert: `\n   *     attribute vec3 a_position;\n   *     void main() {\n   *       gl_Position = vec4( a_position, 1.0 );\n   *     }\n   *   `,\n   *   frag: `\n   *     precision mediump float;\n   *     void main() {\n   *       gl_FragColor = vec4( 1.0, 1.0, 1.0, 1.0 );\n   *     }\n   *   `\n   * });\n   */\n  constructor(device, options) {\n    this._device = device;\n\n    // stores gl information: { location, type }\n    this._attributes = [];\n    this._uniforms = [];\n    this._samplers = [];\n\n    this._linked = false;\n    this._vertSource = options.vert;\n    this._fragSource = options.frag;\n    this._program = null;\n  }\n\n  link() {\n    if (this._linked) {\n      return;\n    }\n\n    let gl = this._device._gl;\n\n    let vertShader = _createShader(gl, gl.VERTEX_SHADER, this._vertSource);\n    let fragShader = _createShader(gl, gl.FRAGMENT_SHADER, this._fragSource);\n\n    let program = gl.createProgram();\n    gl.attachShader(program, vertShader);\n    gl.attachShader(program, fragShader);\n    gl.linkProgram(program);\n\n    let failed = false;\n\n    if (!gl.getShaderParameter(vertShader, gl.COMPILE_STATUS)) {\n      console.error(`Failed to compile vertex shader: ${gl.getShaderInfoLog(vertShader)}`);\n      failed = true;\n    }\n\n    if (!gl.getShaderParameter(fragShader, gl.COMPILE_STATUS)) {\n      console.error(`Failed to compile fragment shader: ${gl.getShaderInfoLog(fragShader)}`);\n      failed = true;\n    }\n\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n      console.error(`Failed to link shader program: ${gl.getProgramInfoLog(program)}`);\n      failed = true;\n    }\n\n    gl.deleteShader(vertShader);\n    gl.deleteShader(fragShader);\n\n    if (failed) {\n      return;\n    }\n\n    this._program = program;\n\n    // parse attribute\n    let numAttributes = gl.getProgramParameter(program, gl.ACTIVE_ATTRIBUTES);\n    for (let i = 0; i < numAttributes; ++i) {\n      let info = gl.getActiveAttrib(program, i);\n      let location = gl.getAttribLocation(program, info.name);\n\n      this._attributes.push({\n        name: info.name,\n        location: location,\n        type: info.type,\n      });\n    }\n\n    // parse uniform\n    let numUniforms = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);\n    for (let i = 0; i < numUniforms; ++i) {\n      let info = gl.getActiveUniform(program, i);\n      let location = gl.getUniformLocation(program, info.name);\n\n      if ((info.type === gl.SAMPLER_2D) || (info.type === gl.SAMPLER_CUBE)) {\n        this._samplers.push({\n          name: info.name,\n          location: location,\n          type: info.type,\n        });\n      } else {\n        this._uniforms.push({\n          name: info.name,\n          location: location,\n          type: info.type,\n          localId: -1,\n        });\n      }\n    }\n\n    //\n    this._linked = true;\n  }\n\n  destroy() {\n    let gl = this._device._gl;\n    gl.deleteProgram(this._program);\n\n    this._linked = false;\n    this._program = null;\n    this._attributes = [];\n    this._uniforms = [];\n    this._samplers = [];\n  }\n}\n\n// ====================\n// internal\n// ====================\n\nfunction _createShader(gl, type, src) {\n  let shader = gl.createShader(type);\n  gl.shaderSource(shader, src);\n  gl.compileShader(shader);\n\n  return shader;\n}","import { enums } from './enums';\n\nexport default class Texture {\n  /**\n   * @constructor\n   */\n  constructor(device) {\n    this._device = device;\n\n    this._width = 4;\n    this._height = 4;\n    this._hasMipmap = false;\n\n    this._anisotropy = 1;\n    this._minFilter = enums.FILTER_LINEAR;\n    this._magFilter = enums.FILTER_LINEAR;\n    this._mipFilter = enums.FILTER_LINEAR;\n    this._wrapS = enums.WRAP_REPEAT;\n    this._wrapT = enums.WRAP_REPEAT;\n    this._format = enums.TEXTURE_FMT_RGBA8;\n  }\n\n  /**\n   * @method destroy\n   */\n  destroy() {\n    if (this._id === -1) {\n      console.error('The texture already destroyed');\n      return;\n    }\n\n    let gl = this.device.gl;\n    gl.deleteTexture(this._id);\n\n    this.device._vram.tex -= this.bytes;\n    this._id = -1;\n  }\n}","import Texture from './texture';\nimport { glFilter } from './enums';\n\nexport default class Texture2D extends Texture {\n  /**\n   * @constructor\n   * @param {Object} options\n   * @param {Array} options.images\n   * @param {Boolean} options.mipmap\n   * @param {Number} options.width\n   * @param {Number} options.height\n   * @param {Number} options.anisotropy\n   * @param {FILTER_*} options.minFilter\n   * @param {FILTER_*} options.magFilter\n   * @param {FILTER_*} options.mipFilter\n   * @param {WRAP_*} options.wrapS\n   * @param {WRAP_*} options.wrapT\n   */\n  constructor(device, options) {\n    super(device);\n    this.update(options);\n  }\n\n  update(options) {\n    let gl = this._device._gl;\n    let genMipmap = this._hasMipmap;\n\n    if (options) {\n      if (options.width !== undefined) {\n        this._width = options.width;\n      }\n      if (options.height !== undefined) {\n        this._height = options.height;\n      }\n      if (options.anisotropy !== undefined) {\n        this._anisotropy = options.anisotropy;\n      }\n      if (options.minFilter !== undefined) {\n        this._minFilter = options.minFilter;\n      }\n      if (options.magFilter !== undefined) {\n        this._magFilter = options.magFilter;\n      }\n      if (options.mipFilter !== undefined) {\n        this._mipFilter = options.mipFilter;\n      }\n      if (options.wrapS !== undefined) {\n        this._wrapS = options.wrapS;\n      }\n      if (options.wrapT !== undefined) {\n        this._wrapT = options.wrapT;\n      }\n      if (options.format !== undefined) {\n        this._format = options.format;\n      }\n\n      // check if generate mipmap\n      if (options.mipmap !== undefined) {\n        this._hasMipmap = options.mipmap;\n        genMipmap = options.mipmap;\n      }\n\n      if (options.images !== undefined) {\n        if (options.images.length > 1) {\n          genMipmap = false;\n        }\n      }\n    }\n\n    gl.activeTexture(gl.TEXTURE0);\n    gl.bindTexture(gl.TEXTURE_2D, this._id);\n      if (options.images !== undefined) {\n        this._setMipmap(options.images);\n      }\n\n      this._setTexInfo();\n\n      if (genMipmap) {\n        gl.hint(gl.GENERATE_MIPMAP_HINT, gl.NICEST);\n        gl.generateMipmap(gl.TEXTURE_2D);\n      }\n    gl.bindTexture(gl.TEXTURE_2D, null);\n  }\n\n  _setMipmap(images) {\n    let gl = this._device._gl;\n\n    // TODO\n    for (let i = 0; i < images.length; ++i) {\n      let img = images[i];\n\n      gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\n      gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);\n    }\n  }\n\n  _setTexInfo() {\n    let gl = this._device._gl;\n\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, glFilter(gl, this._minFilter, this._hasMipmap ? this._mipFilter : -1));\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, glFilter(gl, this._magFilter, -1));\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, this._wrapS);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, this._wrapT);\n\n    if (this._device.ext('EXT_texture_filter_anisotropic')) {\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAX_ANISOTROPY_EXT, this._anisotropic);\n    }\n  }\n}","\nexport default class Device {\n  /**\n   * @param {HTMLElement} canvasEL\n   * @param {object} opts\n   */\n  constructor(canvasEL, opts) {\n    let gl;\n\n    try {\n      gl = canvasEL.getContext('webgl', opts);\n    } catch (err) {\n      console.error(err);\n      return;\n    }\n\n    this._gl = gl;\n    this._extensions = {};\n    this._vram = { texture: 0, vb: 0, ib: 0 };\n\n    this._initExtensions([\n      'OES_vertex_array_object',\n      'OES_texture_float',\n      'OES_texture_half_float',\n      'OES_texture_half_float_linear',\n      'WEBGL_compressed_texture_s3tc',\n      'WEBGL_compressed_texture_pvrtc',\n      'WEBGL_compressed_texture_etc1',\n      'WEBGL_compressed_texture_atc',\n      'EXT_texture_filter_anisotropic'\n    ]);\n  }\n\n  _initExtensions(extensions) {\n    let gl = this._gl;\n\n    for (let i = 0; i < extensions.length; ++i) {\n      let name = extensions[i];\n\n      try {\n        let ext = gl.getExtension(name);\n        if (ext) {\n          this._extensions[name] = ext;\n        }\n\n      } catch (e) {\n        console.error(e);\n      }\n    }\n  }\n\n  ext(name) {\n    return this._extensions[name];\n  }\n\n  // TODO: set states\n\n  draw(base, count) {\n    // TODO\n  }\n}","\nimport {\n  enums,\n  attrTypeBytes,\n  glFilter,\n  glTextureFmt,\n} from './lib/enums';\nimport IndexBuffer from './lib/index-buffer';\nimport VertexBuffer from './lib/vertex-buffer';\nimport Shader from './lib/shader';\nimport Texture from './lib/texture';\nimport Texture2D from './lib/texture-2d';\nimport Device from './lib/device';\n\nlet gfx = {\n  // classes\n  IndexBuffer,\n  VertexBuffer,\n  Shader,\n  Texture,\n  Texture2D,\n  Device,\n\n  // functions\n  attrTypeBytes,\n  glFilter,\n  glTextureFmt,\n};\nObject.assign(gfx, enums);\n\nexport default gfx;"],"names":[],"mappings":"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"}